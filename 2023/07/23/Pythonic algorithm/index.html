

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="lgw">
  <meta name="keywords" content="">
  
    <meta name="description" content="Pythonic algorithm 计算机基础 Mbps、KBps、MB、kb、B、b 1B(字节) &#x3D; 8b(位) 1MB &#x3D; 1024KB				1KB &#x3D; 1024B 1Mbps &#x3D; 1000Kbps		1Kbps &#x3D; 1000bps 1MBps &#x3D; 8Mbps 12345678910&gt;&gt;&gt; MBtoKB &#x3D; lambda x: 1024 * x... KBtoB &#x3D; l">
<meta property="og:type" content="article">
<meta property="og:title" content="Pythonic algorithm">
<meta property="og:url" content="https://lgw.asia/2023/07/23/Pythonic%20algorithm/index.html">
<meta property="og:site_name" content="lgw&#39;s blog">
<meta property="og:description" content="Pythonic algorithm 计算机基础 Mbps、KBps、MB、kb、B、b 1B(字节) &#x3D; 8b(位) 1MB &#x3D; 1024KB				1KB &#x3D; 1024B 1Mbps &#x3D; 1000Kbps		1Kbps &#x3D; 1000bps 1MBps &#x3D; 8Mbps 12345678910&gt;&gt;&gt; MBtoKB &#x3D; lambda x: 1024 * x... KBtoB &#x3D; l">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/03/19/ir6LMUxNgE1OuA7.png">
<meta property="og:image" content="https://s2.loli.net/2022/03/19/Clqt6g9f3kayG15.jpg">
<meta property="og:image" content="https://s2.loli.net/2022/03/19/dhfyRCwQA8KJVme.png">
<meta property="og:image" content="https://s2.loli.net/2022/03/19/bkuKqIUh5E1J6wT.png">
<meta property="og:image" content="https://s2.loli.net/2022/03/24/gECpY4h9SrunRyJ.jpg">
<meta property="og:image" content="https://s2.loli.net/2022/03/24/GnCl37yEIhB1pz5.png">
<meta property="og:image" content="https://s2.loli.net/2022/03/22/LcXNhO5yEmgd2Ci.jpg">
<meta property="og:image" content="https://cdn.acwing.com/media/article/image/2019/12/13/1833_db6dffa81d-37ff39642fd8f74476ddcd99944d1b4.png">
<meta property="og:image" content="https://s2.loli.net/2022/03/06/Dy4eP5hfGHl7k3d.png">
<meta property="article:published_time" content="2023-07-22T16:05:52.221Z">
<meta property="article:modified_time" content="2023-10-19T07:24:31.338Z">
<meta property="article:author" content="lgw">
<meta property="article:tag" content="编程">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://s2.loli.net/2022/03/19/ir6LMUxNgE1OuA7.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Pythonic algorithm - lgw&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/KaTeX/0.16.2/katex.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"lgw.asia","root":"/","version":"1.9.5-a","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":false,"baidu":"44af5216078ef57ddfa21fe3e25e69b5","google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?44af5216078ef57ddfa21fe3e25e69b5";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>lgw&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Pythonic algorithm"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-07-23 00:05" pubdate>
          2023年7月23日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    

    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Pythonic algorithm</h1>
            
            
              <div class="markdown-body">
                
                <h1>Pythonic algorithm</h1>
<h1>计算机基础</h1>
<h2 id="Mbps、KBps、MB、kb、B、b">Mbps、KBps、MB、kb、B、b</h2>
<p>1B(字节) = 8b(位)</p>
<p>1MB = 1024KB				1KB = 1024B</p>
<p>1Mbps = 1000Kbps		1Kbps = 1000bps</p>
<p>1MBps = 8Mbps</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>MBtoKB = <span class="hljs-keyword">lambda</span> x: <span class="hljs-number">1024</span> * x<br><span class="hljs-meta">... </span>KBtoB = <span class="hljs-keyword">lambda</span> x: <span class="hljs-number">1024</span> * x<br><span class="hljs-meta">... </span>Btob = <span class="hljs-keyword">lambda</span> x: <span class="hljs-number">8</span> * x<br><span class="hljs-meta">... </span>MB = <span class="hljs-number">256</span><br><span class="hljs-meta">... </span>KB = MBtoKB(MB)<br><span class="hljs-meta">... </span>B = KBtoB(KB)<br><span class="hljs-meta">... </span>b = Btob(B)<br><span class="hljs-meta">... </span>n = b // <span class="hljs-number">32</span><br>n<br><span class="hljs-number">67108864</span><br></code></pre></td></tr></table></figure>
<h2 id="数据范围反推算法复杂度以及算法内容">数据范围反推算法复杂度以及算法内容</h2>
<p>时间限制1秒或2秒。在这种情况下，C++代码中的操作次数控制在 10^7∼10^8为最佳。</p>
<p>下面给出在不同数据范围下，代码的时间复杂度和算法该如何选择：</p>
<h3 id="n-≤-30">n ≤ 30</h3>
<p><strong>指数级别</strong>, dfs+剪枝，状态压缩dp</p>
<h3 id="n-≤-100">n ≤ 100</h3>
<p><strong>O(n^3)</strong>，floyd，dp，高斯消元</p>
<h3 id="n-≤-1000">n ≤ 1000</h3>
<p><strong>O(n^2)，O(n^2logn)</strong>，dp，二分，朴素版Dijkstra、朴素版Prim、Bellman-Ford</p>
<h3 id="n-≤-10000">n ≤ 10000</h3>
<p><strong>O(n∗sqrt(n))</strong>，块状链表、分块、莫队</p>
<h3 id="n-≤-100000">n ≤ 100000</h3>
<p><strong>O(nlogn)</strong> =&gt; 各种sort，线段树、树状数组、set/map、heap、拓扑排序、dijkstra+heap、prim+heap、Kruskal、spfa、求凸包、求半平面交、二分、CDQ分治、整体二分、后缀数组、树链剖分、动态树</p>
<h3 id="n≤1000000">n≤1000000</h3>
<p><strong>O(n)</strong>, 以及常数较小的 O(nlogn) 算法 =&gt; 单调队列、 hash、双指针扫描、并查集，kmp、AC自动机，常数比较小的 O(nlogn) 的做法：sort、树状数组、heap、dijkstra、spfa</p>
<h3 id="n-≤-10000000">n ≤ 10000000</h3>
<p><strong>O(n)</strong>，双指针扫描、kmp、AC自动机、线性筛素数</p>
<h3 id="n-≤-10-9">n ≤ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup></mrow><annotation encoding="application/x-tex">10^9</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">9</span></span></span></span></span></span></span></span></span></span></span></h3>
<p><strong>O(sqrt(n))</strong>，判断质数</p>
<h3 id="n-≤-10-18">n ≤ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>18</mn></msup></mrow><annotation encoding="application/x-tex">10^{18}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">18</span></span></span></span></span></span></span></span></span></span></span></span></h3>
<p><strong>O(logn)</strong>，最大公约数，快速幂，数位DP</p>
<h3 id="n-≤-10-1000">n ≤ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>1000</mn></msup></mrow><annotation encoding="application/x-tex">10^{1000}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1000</span></span></span></span></span></span></span></span></span></span></span></span></h3>
<p><strong>O((logn)^2)</strong>，高精度加减乘除</p>
<h3 id="n-≤-10-100000">n ≤ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mn>100000</mn></msup></mrow><annotation encoding="application/x-tex">10^{100000}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">100000</span></span></span></span></span></span></span></span></span></span></span></span></h3>
<p><strong>O(logk×loglogk)，k表示位数</strong>，高精度加减、FFT/NTT</p>
<h1>基本知识</h1>
<h2 id="Python运算符">Python运算符</h2>
<p>0为False，非0为True</p>
<p><img src="https://s2.loli.net/2022/03/19/ir6LMUxNgE1OuA7.png" srcset="/img/loading.gif" lazyload alt="image-20220319090755721"></p>
<h2 id="内置函数">内置函数</h2>
<h3 id="判断类型">判断类型</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">type</span>(<span class="hljs-number">1.0</span>)<br>Out[<span class="hljs-number">2</span>]: <span class="hljs-built_in">float</span><br><span class="hljs-built_in">type</span>(<span class="hljs-number">3</span>) == <span class="hljs-built_in">int</span><br>Out[<span class="hljs-number">3</span>]: <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure>
<h3 id="幂">幂</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">3</span> ** <span class="hljs-number">10</span><br>Out[<span class="hljs-number">2</span>]: <span class="hljs-number">59049</span><br><span class="hljs-number">2</span> ** -<span class="hljs-number">0.7</span><br>Out[<span class="hljs-number">3</span>]: <span class="hljs-number">0.6155722066724582</span><br><span class="hljs-number">3</span> ** <span class="hljs-number">0.5</span><br>Out[<span class="hljs-number">4</span>]: <span class="hljs-number">1.7320508075688772</span><br></code></pre></td></tr></table></figure>
<h3 id="绝对值">绝对值</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">abs</span>(-<span class="hljs-number">1.7</span>)<br>Out[<span class="hljs-number">3</span>]: <span class="hljs-number">1.7</span><br></code></pre></td></tr></table></figure>
<h3 id="求和">求和</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">sum</span>([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [], [<span class="hljs-number">1</span>]], [])<br>Out[<span class="hljs-number">4</span>]: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]<br></code></pre></td></tr></table></figure>
<h3 id="最值">最值</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">max</span>(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>)<br>Out[<span class="hljs-number">2</span>]: <span class="hljs-number">4</span><br><span class="hljs-built_in">min</span>([<span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>])<br>Out[<span class="hljs-number">3</span>]: <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>
<h3 id="四舍五入">四舍五入</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">x, y = <span class="hljs-number">1.555</span>, <span class="hljs-number">1.5555</span><br><br><span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;x:<span class="hljs-number">.2</span>f&#125;</span> <span class="hljs-subst">&#123;y:<span class="hljs-number">.2</span>f&#125;</span>&#x27;</span><br><br><br><span class="hljs-string">&#x27;1.55 1.56&#x27;</span><br></code></pre></td></tr></table></figure>
<h2 id="装饰器">装饰器</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">print_time</span>(<span class="hljs-params">func</span>):<br>    <span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> time<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapped</span>(<span class="hljs-params">*args, **kwargs</span>):<br>        t = time()<br>        res = func(*args, **kwargs)<br>        <span class="hljs-built_in">print</span>(func.__name__, <span class="hljs-string">&quot;time cost:&quot;</span>, time() - t)<br>        <span class="hljs-keyword">return</span> res<br><br>    <span class="hljs-keyword">return</span> wrapped<br><br><br><span class="hljs-meta">@print_time</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">makeE</span>(<span class="hljs-params">n</span>):<br>    E = [[<span class="hljs-number">0</span>] * n <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        E[i][i] = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> E<br></code></pre></td></tr></table></figure>
<h2 id="常用操作">常用操作</h2>
<h3 id="修改最大递归深度">修改最大递归深度</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sys <span class="hljs-keyword">import</span> setrecursionlimit<br>setrecursionlimit(<span class="hljs-built_in">int</span>(<span class="hljs-number">1e6</span>))<br></code></pre></td></tr></table></figure>
<h3 id="无穷量">无穷量</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">a = <span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>)<br>-<span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>)<br>Out[<span class="hljs-number">2</span>]: -inf<br>c = <span class="hljs-number">3</span><br>c = <span class="hljs-built_in">min</span>(c, a)<br>c<br>Out[<span class="hljs-number">3</span>]: <span class="hljs-number">3</span><br><span class="hljs-built_in">type</span>(c)<br>Out[<span class="hljs-number">4</span>]: <span class="hljs-built_in">int</span><br></code></pre></td></tr></table></figure>
<h3 id="科学计数法">科学计数法</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">int</span>(<span class="hljs-number">1e5</span>)<br>Out[<span class="hljs-number">2</span>]: <span class="hljs-number">100000</span><br><span class="hljs-number">1e-4</span><br>Out[<span class="hljs-number">3</span>]: <span class="hljs-number">0.0001</span><br></code></pre></td></tr></table></figure>
<h3 id="不定长度输入">不定长度输入</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">try</span>:<br>        f(<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>()))<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>
<h3 id="2维列表合并">2维列表合并</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">[[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]] + [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">1</span>]]<br>Out[<span class="hljs-number">3</span>]: [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">1</span>]]<br></code></pre></td></tr></table></figure>
<h3 id="2维列表复制">2维列表复制</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">g = [l.copy() <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> graph]<br></code></pre></td></tr></table></figure>
<h3 id="字典">字典</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> heapq<br>result = []<br>n, d, k = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>record = &#123;&#125;<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    ts, <span class="hljs-built_in">id</span> = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">id</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> record:<br>        record[<span class="hljs-built_in">id</span>] = []<br>    record[<span class="hljs-built_in">id</span>].append(ts)<br><span class="hljs-keyword">for</span> <span class="hljs-built_in">id</span>, ts <span class="hljs-keyword">in</span> record.items():<br>    a = <span class="hljs-built_in">sorted</span>(ts)<br>    s, m = <span class="hljs-number">0</span>, <span class="hljs-number">10001</span><br>    l = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> R <span class="hljs-keyword">in</span> a:<br>        s += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">while</span> s &gt;= k:<br>            m = <span class="hljs-built_in">min</span>(m, R - a[l] + <span class="hljs-number">1</span>)<br>            s -= <span class="hljs-number">1</span><br>            l += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> m &lt;= d:<br>        heapq.heappush(result, <span class="hljs-built_in">id</span>)<br><span class="hljs-keyword">while</span> result:<br>    <span class="hljs-built_in">print</span>(heapq.heappop(result))<br></code></pre></td></tr></table></figure>
<h3 id="元组">元组</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">b = (<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>a = (<span class="hljs-number">1</span>,)<br>a + b<br>Out[<span class="hljs-number">7</span>]: (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br></code></pre></td></tr></table></figure>
<h3 id="集合交并">集合交并</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">a = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<br>b = &#123;<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>&#125;<br>a | b<br>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>&#125;<br>a &amp; b<br>&#123;<span class="hljs-number">2</span>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="重定向输入">重定向输入</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys <br>sys.stdin = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;large.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <br></code></pre></td></tr></table></figure>
<h3 id="测速指令">测速指令</h3>
<p>ipython特性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>(<span class="hljs-params">n</span>):<br>    n &lt;&lt;= <span class="hljs-number">20</span><br>    <span class="hljs-keyword">return</span> [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br>%timeit f(<span class="hljs-number">1</span>)<br><span class="hljs-number">54.1</span> ms ± <span class="hljs-number">1.29</span> ms per loop (mean ± std. dev. of <span class="hljs-number">7</span> runs, <span class="hljs-number">10</span> loops each)<br></code></pre></td></tr></table></figure>
<h1>标准库</h1>
<h2 id="datetime">datetime</h2>
<h3 id="date类">date类</h3>
<p>date类包含三个参数，分别为year，month，day，返回格式为year-month-day。</p>
<p>date对象表示理想化日历中的日期(年、月和日), 公历1年1月1日被称为第一天，依次往后推。</p>
<p>其中用户创建时间的类方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> datetime<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;今天的日期是:&quot;</span>,datetime.date.today())     <span class="hljs-comment"># 今日的日期</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;使用时间戳创建的日期：&quot;</span>,datetime.date.fromtimestamp(<span class="hljs-number">1234567896</span>))   <span class="hljs-comment">#  使用时间戳创建日期</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;使用公历序数创建的日期：&quot;</span>,datetime.date.fromordinal(<span class="hljs-number">1</span>))    <span class="hljs-comment"># 使用公历序数创建的日期</span><br><br>结果如下：<br><br>今天的日期是: <span class="hljs-number">2020</span>-08-<span class="hljs-number">31</span><br>使用时间戳创建的日期： <span class="hljs-number">2009</span>-02-<span class="hljs-number">14</span><br>使用公历序数创建的日期： 0001-01-01<br></code></pre></td></tr></table></figure>
<p>对象的属性及方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> datetime<br><br>today = datetime.date(year=<span class="hljs-number">2020</span>,month=<span class="hljs-number">8</span>,day=<span class="hljs-number">31</span>)   <span class="hljs-comment">#  使用参数创建日期</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;date对象的年份:&#x27;</span>, today.year)    <br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;date对象的月份:&#x27;</span>, today.month)   <br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;date对象的日:&#x27;</span>, today.day)  <br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;date对象的struct_time结构为：&quot;</span>,today.timetuple())<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;返回当前公历日期的序数:&quot;</span>,today.toordinal())   <span class="hljs-comment">#  与fromordinal函数作用相反</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;当前日期为星期(其中：周一对应0):&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(today.weekday()))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;当前日期为星期(其中：周一对应1):&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(today.isoweekday()))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;当前日期的年份、第几周、周几(其中返回为元组):&quot;</span>,today.isocalendar())<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;以ISO 8601格式‘YYYY-MM-DD’返回date的字符串形式：&quot;</span>,today.isoformat())<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;返回一个表示日期的字符串(其格式如：Mon Aug 31 00:00:00 2020):&quot;</span>,today.ctime())<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;指定格式为：&quot;</span>,today.strftime(<span class="hljs-string">&quot;%Y/%m/%d&quot;</span>))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;替换后的日期为：&quot;</span>,today.replace(<span class="hljs-number">2019</span>,<span class="hljs-number">9</span>,<span class="hljs-number">29</span>))<br><br>结果如下：<br><br>date对象的年份: <span class="hljs-number">2020</span><br>date对象的月份: <span class="hljs-number">8</span><br>date对象的日: <span class="hljs-number">31</span><br>date对象的struct_time结构为： time.struct_time(tm_year=<span class="hljs-number">2020</span>, tm_mon=<span class="hljs-number">8</span>, tm_mday=<span class="hljs-number">31</span>, tm_hour=<span class="hljs-number">0</span>, tm_min=<span class="hljs-number">0</span>, tm_sec=<span class="hljs-number">0</span>, tm_wday=<span class="hljs-number">0</span>, tm_yday=<span class="hljs-number">244</span>, tm_isdst=-<span class="hljs-number">1</span>)<br>返回当前公历日期的序数: <span class="hljs-number">737668</span><br>当前日期为星期(其中：周一对应<span class="hljs-number">0</span>):<span class="hljs-number">0</span><br>当前日期为星期(其中：周一对应<span class="hljs-number">1</span>):<span class="hljs-number">1</span><br>当前日期的年份、第几周、周几(其中返回为元组): (<span class="hljs-number">2020</span>, <span class="hljs-number">36</span>, <span class="hljs-number">1</span>)<br>以ISO <span class="hljs-number">8601</span>格式‘YYYY-MM-DD’返回date的字符串形式： <span class="hljs-number">2020</span>-08-<span class="hljs-number">31</span><br>返回一个表示日期的字符串(其格式如：Mon Aug <span class="hljs-number">31</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-number">2020</span>): Mon Aug <span class="hljs-number">31</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> <span class="hljs-number">2020</span><br>指定格式为： <span class="hljs-number">2020</span>/08/<span class="hljs-number">31</span><br>替换后的日期为： <span class="hljs-number">2019</span>-09-<span class="hljs-number">29</span><br></code></pre></td></tr></table></figure>
<p>其中，格式化的表达式如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python">%y 两位数的年份表示（<span class="hljs-number">00</span>-<span class="hljs-number">99</span>）<br>%Y 四位数的年份表示（<span class="hljs-number">000</span>-<span class="hljs-number">9999</span>）<br>%m 月份（01-<span class="hljs-number">12</span>）<br>%d 月内中的一天（<span class="hljs-number">0</span>-<span class="hljs-number">31</span>）<br>%H <span class="hljs-number">24</span>小时制小时数（<span class="hljs-number">0</span>-<span class="hljs-number">23</span>）<br>%I <span class="hljs-number">12</span>小时制小时数（01-<span class="hljs-number">12</span>）<br>%M 分钟数（<span class="hljs-number">00</span>=<span class="hljs-number">59</span>）<br>%S 秒（<span class="hljs-number">00</span>-<span class="hljs-number">59</span>）<br>%a 本地简化星期名称<br>%A 本地完整星期名称<br>%b 本地简化的月份名称<br>%B 本地完整的月份名称<br>%c 本地相应的日期表示和时间表示<br>%j 年内的一天（001-<span class="hljs-number">366</span>）<br>%p 本地A.M.或P.M.的等价符<br>%U 一年中的星期数（<span class="hljs-number">00</span>-<span class="hljs-number">53</span>）星期天为星期的开始<br>%w 星期（<span class="hljs-number">0</span>-<span class="hljs-number">6</span>），星期天为星期的开始<br>%W 一年中的星期数（<span class="hljs-number">00</span>-<span class="hljs-number">53</span>）星期一为星期的开始<br>%x 本地相应的日期表示<br>%X 本地相应的时间表示<br>%Z 当前时区的名称<br>%% %号本身<br></code></pre></td></tr></table></figure>
<h2 id="itertools">itertools</h2>
<h3 id="itertools-combinations">itertools.combinations</h3>
<p>求列表或生成器中指定数目的元素不重复的所有组合</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>x = itertools.combinations(<span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>), <span class="hljs-number">3</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(x))<br>[(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>), (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)]<br></code></pre></td></tr></table></figure>
<h3 id="itertools-permutations">itertools.permutations</h3>
<p>产生指定数目的元素的所有排列(顺序有关)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>x = itertools.permutations(<span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>), <span class="hljs-number">3</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(x))<br>[(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>), (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>), (<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>), (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>), (<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>), (<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>), (<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>), (<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>), (<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>), (<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>)] <br></code></pre></td></tr></table></figure>
<h2 id="functools">functools</h2>
<h3 id="functools-lru-cache">@functools.lru_cache()</h3>
<p><code>lru_cache()</code> 装饰器是 <em>缓存淘汰算法</em>(最近较少使用)的一种实现。其使用函数的参数作为key结果作为value缓存在hash结构中(因此函数的参数必须是hashable)，如果后续使用相同参数再次调用将从hash从返回结果。同时装饰器还添加了检查缓存转态方法(<code>cache_info()</code>)和清空缓存方法(<code>cache_clear()</code>)给函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Cache</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">from</span> sys <span class="hljs-keyword">import</span> setrecursionlimit<br>        <span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> lru_cache<br><br>        setrecursionlimit(<span class="hljs-built_in">int</span>(<span class="hljs-number">1e6</span>))<br><br>        self.lru_cache = lru_cache<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.lru_cache(maxsize=<span class="hljs-literal">None</span>)     <span class="hljs-comment"># return key is function</span><br></code></pre></td></tr></table></figure>
<h3 id="functools-total-ordering">@functools.total_ordering</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@functools.total_ordering</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, frequency, char = <span class="hljs-string">&quot;&quot;</span></span>):<br>        self.frequency = frequency<br>        self.char = char<br>        self.left = <span class="hljs-literal">None</span><br>        self.right = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__eq__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> self.frequency == other.frequency<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__gt__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> self.frequency &gt; other.frequency<br></code></pre></td></tr></table></figure>
<h2 id="deque">deque</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br>d = deque()<br>d.append(<span class="hljs-number">1</span>)<br>d.append(<span class="hljs-number">2</span>)<br>d.appendleft(<span class="hljs-number">3</span>)<br><span class="hljs-built_in">len</span>(d)<br>Out[<span class="hljs-number">3</span>]: <span class="hljs-number">3</span><br>d.clear()<br>d<br>Out[<span class="hljs-number">6</span>]: deque([])<br>d.extend([<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>])<br>d<br>Out[<span class="hljs-number">8</span>]: deque([<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>])<br>d.extendleft([<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>])<br>d<br>Out[<span class="hljs-number">10</span>]: deque([<span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>])<br>d.pop()<br>Out[<span class="hljs-number">11</span>]: <span class="hljs-number">6</span><br>d.popleft()<br>Out[<span class="hljs-number">12</span>]: <span class="hljs-string">&#x27;c&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> d:<br>    <span class="hljs-built_in">print</span>(i)<br>b<br>a<br><span class="hljs-number">2</span><br><span class="hljs-number">4</span><br>d[<span class="hljs-number">0</span>]<br>Out[<span class="hljs-number">14</span>]: <span class="hljs-string">&#x27;b&#x27;</span><br>d[-<span class="hljs-number">1</span>]<br>Out[<span class="hljs-number">15</span>]: <span class="hljs-number">4</span><br></code></pre></td></tr></table></figure>
<h2 id="heapq">heapq</h2>
<h3 id="最小堆">最小堆</h3>
<p>将x压入堆中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">heappush(heap, x)<br></code></pre></td></tr></table></figure>
<p>从堆中弹出最小的元素</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">heappop(heap) <br></code></pre></td></tr></table></figure>
<p>让列表具备堆特征</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">heapify(heap) <br></code></pre></td></tr></table></figure>
<p>返回iter中n个最小的元素</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">nsmallest(n, <span class="hljs-built_in">iter</span>)<br></code></pre></td></tr></table></figure>
<h2 id="math库">math库</h2>
<h3 id="排列组合">排列组合</h3>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">math</span>.factorial(<span class="hljs-number">5</span>)<br><span class="hljs-attribute">120</span><br><br><span class="hljs-attribute">math</span>.perm(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>)<br><span class="hljs-attribute">60</span><br><br><span class="hljs-attribute">math</span>.comb(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>)<br><span class="hljs-attribute">10</span><br></code></pre></td></tr></table></figure>
<h3 id="对数">对数</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">math.log(<span class="hljs-number">2</span>)<br>Out[<span class="hljs-number">13</span>]: <span class="hljs-number">0.6931471805599453</span><br>math.log(<span class="hljs-number">2</span>, math.e)<br>Out[<span class="hljs-number">14</span>]: <span class="hljs-number">0.6931471805599453</span><br>math.log(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>)<br>Out[<span class="hljs-number">15</span>]: <span class="hljs-number">2.0</span><br>math.log2(<span class="hljs-number">4</span>)<br>Out[<span class="hljs-number">16</span>]: <span class="hljs-number">2.0</span><br></code></pre></td></tr></table></figure>
<h3 id="上取整">上取整</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">math.ceil(<span class="hljs-number">1.0</span>)<br>Out[<span class="hljs-number">6</span>]: <span class="hljs-number">1</span><br>math.ceil(<span class="hljs-number">1.3</span>)<br>Out[<span class="hljs-number">7</span>]: <span class="hljs-number">2</span><br><span class="hljs-built_in">type</span>(math.ceil(<span class="hljs-number">1.3</span>))<br>Out[<span class="hljs-number">8</span>]: <span class="hljs-built_in">int</span><br></code></pre></td></tr></table></figure>
<h3 id="最大公约数">最大公约数</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> gcd<br>gcd(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br>Out[<span class="hljs-number">3</span>]: <span class="hljs-number">0</span><br>gcd(<span class="hljs-number">21</span>, <span class="hljs-number">14</span>)<br>Out[<span class="hljs-number">4</span>]: <span class="hljs-number">7</span><br>gcd(<span class="hljs-number">0</span>, <span class="hljs-number">6</span>)<br>Out[<span class="hljs-number">5</span>]: <span class="hljs-number">6</span><br></code></pre></td></tr></table></figure>
<h2 id="bisect库">bisect库</h2>
<p>bisect_left等价于bound(f, a) + 1，f使小于target真</p>
<p>bisect等价于bound(f, a) + 1，f使小于等于target真</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> bisect<br>l = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<br>bisect.bisect_left(l, <span class="hljs-number">4</span>)<br>Out[<span class="hljs-number">2</span>]: <span class="hljs-number">2</span><br>bisect.bisect_left(l, <span class="hljs-number">3</span>)<br>Out[<span class="hljs-number">3</span>]: <span class="hljs-number">2</span><br>bisect.bisect_left(l, <span class="hljs-number">6</span>)<br>Out[<span class="hljs-number">4</span>]: <span class="hljs-number">6</span><br>bisect.bisect_left(l, <span class="hljs-number">1</span>)<br>Out[<span class="hljs-number">5</span>]: <span class="hljs-number">0</span><br>bisect.bisect_left(l, <span class="hljs-number">0</span>)<br>Out[<span class="hljs-number">6</span>]: <span class="hljs-number">0</span><br>bisect.bisect(l, <span class="hljs-number">4</span>)<br>Out[<span class="hljs-number">3</span>]: <span class="hljs-number">5</span><br>bisect.bisect(l, <span class="hljs-number">3</span>)<br>Out[<span class="hljs-number">4</span>]: <span class="hljs-number">2</span><br>bisect.bisect(l, <span class="hljs-number">1</span>)<br>Out[<span class="hljs-number">5</span>]: <span class="hljs-number">1</span><br>bisect.bisect(l, <span class="hljs-number">0</span>)<br>Out[<span class="hljs-number">6</span>]: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<h1>数学知识</h1>
<h2 id="数论">数论</h2>
<h3 id="快速幂">快速幂</h3>
<p>随时取余</p>
<p><img src="https://s2.loli.net/2022/03/19/Clqt6g9f3kayG15.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ModCalculation</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, mod=<span class="hljs-number">0</span></span>):<br>        self.mod = mod<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_mod</span>(<span class="hljs-params">self, a</span>):<br>        <span class="hljs-keyword">return</span> a % self.mod <span class="hljs-keyword">if</span> self.mod <span class="hljs-keyword">else</span> a<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_add</span>(<span class="hljs-params">self, a, b</span>):<br>        <span class="hljs-keyword">return</span> (a + b) % self.mod <span class="hljs-keyword">if</span> self.mod <span class="hljs-keyword">else</span> a + b<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">self, *args</span>):<br>        s = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> args:<br>            s = self._add(s, i)<br>        <span class="hljs-keyword">return</span> s<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params">self, iterable</span>):<br>        <span class="hljs-keyword">return</span> self.add(*iterable)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_mul</span>(<span class="hljs-params">self, a, b</span>):<br>        <span class="hljs-keyword">return</span> (a * b) % self.mod <span class="hljs-keyword">if</span> self.mod <span class="hljs-keyword">else</span> a * b<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">mul</span>(<span class="hljs-params">self, *args</span>):<br>        res = <span class="hljs-number">1</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> args:<br>            res = self._mul(res, i)<br>        <span class="hljs-keyword">return</span> res<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">quick_power</span>(<span class="hljs-params">self, a, n</span>):<br>        res = <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">while</span> n:<br>            <span class="hljs-keyword">if</span> n &amp; <span class="hljs-number">1</span>:<br>                res = self.mul(res, a)<br><br>            a = self.mul(a, a)<br>            n &gt;&gt;= <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">return</span> res<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LinearSpace</span>(<span class="hljs-title class_ inherited__">ModCalculation</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, dim, mod=<span class="hljs-number">0</span></span>):<br>        <span class="hljs-built_in">super</span>().__init__(mod)<br>        self.dim = dim<br><br>        self.E = [[<span class="hljs-number">0</span>] * dim <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(dim)]<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(dim):<br>            self.E[i][i] = <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">axb</span>(<span class="hljs-params">self, a, b</span>):<br>        <span class="hljs-keyword">return</span> self.<span class="hljs-built_in">sum</span>(self.mul(i, j) <span class="hljs-keyword">for</span> i, j <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(a, b))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">axA</span>(<span class="hljs-params">self, a, A</span>):<br>        <span class="hljs-keyword">return</span> [self.<span class="hljs-built_in">sum</span>(self.mul(a[i], A[i][j]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.dim)) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.dim)]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">AxB</span>(<span class="hljs-params">self, A, B</span>):<br>        <span class="hljs-keyword">return</span> [self.axA(a, B) <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> A]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">quick_power</span>(<span class="hljs-params">self, A, n</span>):<br>        res = self.E<br><br>        B = A<br>        <span class="hljs-keyword">while</span> n:<br>            <span class="hljs-keyword">if</span> n &amp; <span class="hljs-number">1</span>:<br>                res = self.AxB(res, B)<br><br>            B = self.AxB(B, B)<br>            n &gt;&gt;= <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">return</span> res<br></code></pre></td></tr></table></figure>
<h3 id="裴蜀定理">裴蜀定理</h3>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mi>d</mi><mtext>，</mtext><mi>a</mi><mi>x</mi><mo>+</mo><mi>b</mi><mi>y</mi><mo>=</mo><mi>d</mi><mtext>一定有解，</mtext><mi>a</mi><mi>x</mi><mo>+</mo><mi>b</mi><mi>y</mi><mtext>都是</mtext><mi>d</mi><mtext>倍数</mtext></mrow><annotation encoding="application/x-tex">(a, b)=d，ax+by=d一定有解，ax+by都是d倍数</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">d</span><span class="mord cjk_fallback">，</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">d</span><span class="mord cjk_fallback">一定有解，</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord cjk_fallback">都是</span><span class="mord mathnormal">d</span><span class="mord cjk_fallback">倍数</span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn><mtext>，存在下界，大于下界的数都可以由</mtext><mi>a</mi><mtext>，</mtext><mi>b</mi><mtext>的正整数系数线性表出</mtext></mrow><annotation encoding="application/x-tex">(a, b)=1，存在下界，大于下界的数都可以由a，b的正整数系数线性表出</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">1</span><span class="mord cjk_fallback">，存在下界，大于下界的数都可以由</span><span class="mord mathnormal">a</span><span class="mord cjk_fallback">，</span><span class="mord mathnormal">b</span><span class="mord cjk_fallback">的正整数系数线性表出</span></span></span></span></p>
<p>以上结论易推广到多个数</p>
<p>这里给出一个不精确的下界所有互素数之积，显然大于等于所有互素数之积的数可以被素数的正整数系数线性表出</p>
<h3 id="不定方程">不定方程</h3>
<h4 id="定理">定理</h4>
<p><img src="https://s2.loli.net/2022/03/19/dhfyRCwQA8KJVme.png" srcset="/img/loading.gif" lazyload alt="image-20220319090632543"></p>
<p><img src="https://s2.loli.net/2022/03/19/bkuKqIUh5E1J6wT.png" srcset="/img/loading.gif" lazyload alt="image-20220319090705682"></p>
<h4 id="通解">通解</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">equation</span>(<span class="hljs-params">a, b, c</span>):<br>    d, x, y = exgcd(a, b)<br>    <span class="hljs-keyword">if</span> c % d:<br>        <span class="hljs-keyword">return</span><br>    a //= d<br>    b //= d<br>    c //= d<br>    x *= c<br>    y *= c<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">lambda</span> t: (x + b * t, y - a * t)<br></code></pre></td></tr></table></figure>
<h3 id="线性筛">线性筛</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">linear_sieve</span>(<span class="hljs-params">n</span>):    <span class="hljs-comment"># primes in [2, n]</span><br>    is_prime, primes = [<span class="hljs-literal">True</span>] * (n + <span class="hljs-number">1</span>), []<br><br>    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, n + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> is_prime[p]:<br>            primes.append(p)<br><br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(p * p, n + <span class="hljs-number">1</span>, p):<br>                is_prime[i] = <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">return</span> primes<br></code></pre></td></tr></table></figure>
<h3 id="合数中最小与最大质因数的上确界">合数中最小与最大质因数的上确界</h3>
<h4 id="引理">引理</h4>
<p>合数能唯一分解成质因数之积</p>
<p>合数质因数越少，每个质因数越大</p>
<h4 id="推论">推论</h4>
<p>仅能分解为两个质因数之积的合数的最小与最大质因数的上确界是任一合数的最小与最大质因数的上确界</p>
<p>质因数分布越分散，最小质因数越小，最大质因数越大，反之同理</p>
<h4 id="结论">结论</h4>
<h5 id="合数n最小质因数的上确界">合数n最小质因数的上确界</h5>
<p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>p</mi><mi>m</mi></msub><mo>=</mo><msqrt><mi>n</mi></msqrt></mrow><annotation encoding="application/x-tex">p_m=\sqrt{n}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1908em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8492em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathnormal">n</span></span></span><span style="top:-2.8092em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1908em;"><span></span></span></span></span></span></span></span></span></span></p>
<h5 id="合数n最大质因数的上确界">合数n最大质因数的上确界</h5>
<p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>p</mi><mi>M</mi></msub><mo>=</mo><mfrac><mi>n</mi><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">p_M=\frac{n}{2}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.7936em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<h4 id="应用">应用</h4>
<h5 id="判断质数n">判断质数n</h5>
<p>判断质数只需判断其最小质因数是否存在</p>
<p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>判断是否存在闭区间</mtext><mo stretchy="false">[</mo><mn>2</mn><mo separator="true">,</mo><msub><mi>p</mi><mi>m</mi></msub><mo stretchy="false">]</mo><mtext>中的质数整除</mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">判断是否存在闭区间[2,p_m]中的质数整除n
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">判断是否存在闭区间</span><span class="mopen">[</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mord cjk_fallback">中的质数整除</span><span class="mord mathnormal">n</span></span></span></span></span></p>
<h5 id="质数分解n">质数分解n</h5>
<p>先不妨设n是合数</p>
<p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>则其全体质因数就是闭区间</mtext><mo stretchy="false">[</mo><mn>2</mn><mo separator="true">,</mo><msub><mi>p</mi><mi>M</mi></msub><mo stretchy="false">]</mo><mtext>中所有整除</mtext><mi>n</mi><mtext>的质数</mtext></mrow><annotation encoding="application/x-tex">则其全体质因数就是闭区间[2,p_M]中所有整除n的质数
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">则其全体质因数就是闭区间</span><span class="mopen">[</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mord cjk_fallback">中所有整除</span><span class="mord mathnormal">n</span><span class="mord cjk_fallback">的质数</span></span></span></span></span></p>
<p>若其中没有数整除n，则n是质数，分解后还是n</p>
<h3 id="判断质数">判断质数</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_prime</span>(<span class="hljs-params">n</span>):<br>    sqrt = <span class="hljs-built_in">int</span>(n ** <span class="hljs-number">0.5</span>)<br>    primes = linear_sieve(sqrt)<br>    <br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> primes:<br>        <span class="hljs-keyword">if</span> n % i == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure>
<h3 id="素数分解">素数分解</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">factorization</span>(<span class="hljs-params">n</span>):<br>    p = linear_sieve(n // <span class="hljs-number">2</span>)<br>    factors = &#123;&#125;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push</span>(<span class="hljs-params">p</span>):<br>        <span class="hljs-keyword">if</span> p <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> factors:<br>            factors[p] = <span class="hljs-number">0</span><br>        factors[p] += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> p:<br>        <span class="hljs-keyword">while</span> n % i == <span class="hljs-number">0</span>:<br>            push(i)<br>            n //= i<br><br>        <span class="hljs-keyword">if</span> n == <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> factors <span class="hljs-keyword">and</span> n &gt; <span class="hljs-number">1</span>:<br>        push(n)<br><br>    <span class="hljs-keyword">return</span> factors<br></code></pre></td></tr></table></figure>
<h3 id="因数分解">因数分解</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">break_factor</span>(<span class="hljs-params">n</span>):<br>    sqrt = <span class="hljs-built_in">int</span>(n ** <span class="hljs-number">0.5</span>)<br>    factors = [sqrt]<br><br>    <span class="hljs-keyword">if</span> n // sqrt != sqrt:<br>        factors.append(n // sqrt)<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, sqrt):<br>        <span class="hljs-keyword">if</span> n % i == <span class="hljs-number">0</span>:<br>            factors.append(i)<br>            factors.append(n // i)<br><br>    <span class="hljs-keyword">return</span> factors<br></code></pre></td></tr></table></figure>
<h3 id="约数个数">约数个数</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">count</span>(<span class="hljs-params">n</span>):<br>    factors = breakdown(n)<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(factors.values())<br></code></pre></td></tr></table></figure>
<h3 id="约数和">约数和</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">factors_sum</span>(<span class="hljs-params">n</span>):<br>    s = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> p, e <span class="hljs-keyword">in</span> breakdown(n).items():<br>        s *= <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> i: p ** i, <span class="hljs-built_in">range</span>(e + <span class="hljs-number">1</span>)))<br>    <span class="hljs-keyword">return</span> s<br></code></pre></td></tr></table></figure>
<h3 id="扩展欧几里得">扩展欧几里得</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">exgcd</span>(<span class="hljs-params">a, b</span>):<br>    a_neg, b_neg = <span class="hljs-literal">False</span>, <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">if</span> a &lt; <span class="hljs-number">0</span>:<br>        a = -a<br>        a_neg = <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">if</span> b &lt; <span class="hljs-number">0</span>:<br>        b = -b<br>        b_neg = <span class="hljs-literal">True</span><br><br>    x0, y0 = <span class="hljs-number">1</span>, <span class="hljs-number">0</span>       <span class="hljs-comment"># 本轮使A,B线性组合等于a的系数</span><br>    x1, y1 = <span class="hljs-number">0</span>, <span class="hljs-number">1</span>       <span class="hljs-comment"># 下轮使A,B线性组合等于a的系数</span><br>    <span class="hljs-keyword">while</span> b:<br>        q = a // b<br>        x0, x1 = x1, x0 - q * x1<br>        y0, y1 = y1, y0 - q * y1<br>        a, b = b, a % b<br><br>    <span class="hljs-keyword">if</span> a_neg:<br>        x0 = -x0<br>    <span class="hljs-keyword">if</span> b_neg:<br>        y0 = -y0<br>    <span class="hljs-keyword">return</span> a, x0, y0<br></code></pre></td></tr></table></figure>
<h2 id="组合">组合</h2>
<h3 id="卡特兰数">卡特兰数</h3>
<p>所有包含n个1，n个-1的序列中前缀和始终非负且最终为0的序列数</p>
<p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>C</mi><mrow><mn>2</mn><mi>n</mi></mrow><mi>n</mi></msubsup><mo>−</mo><msubsup><mi>c</mi><mrow><mn>2</mn><mi>n</mi></mrow><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msubsup><mo>=</mo><mfrac><msubsup><mi>C</mi><mrow><mn>2</mn><mi>n</mi></mrow><mi>n</mi></msubsup><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">C^n_{2n}-c^{n+1}_{2n}=\frac{C^n_{2n}}{n+1}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9614em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-2.453em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1205em;vertical-align:-0.2564em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-2.4436em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2564em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1297em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.4519em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<h4 id="进出栈序列">进出栈序列</h4>
<p>n 个元素进栈序列为：1，2，3，4，…，n，则有多少种出栈的元素排列</p>
<p>合法序列前缀和始终非负且最终为0</p>
<p><img src="https://s2.loli.net/2022/03/24/gECpY4h9SrunRyJ.jpg" srcset="/img/loading.gif" lazyload alt="扫描全能王 2022-03-24 11.01"></p>
<h4 id="括号序列">括号序列</h4>
<p><img src="https://s2.loli.net/2022/03/24/GnCl37yEIhB1pz5.png" srcset="/img/loading.gif" lazyload alt="image-20220324110740693"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> comb<br>C = <span class="hljs-keyword">lambda</span> n: comb(n &lt;&lt; <span class="hljs-number">1</span>, n) // (n + <span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>
<h2 id="博弈论">博弈论</h2>
<h3 id="Bash-Game">Bash Game</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">bash</span>(<span class="hljs-params">m, n</span>):<br>    <span class="hljs-keyword">if</span> n % (m + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure>
<h3 id="Nim-Game">Nim Game</h3>
<p><img src="https://s2.loli.net/2022/03/22/LcXNhO5yEmgd2Ci.jpg" srcset="/img/loading.gif" lazyload alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">data = [<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">input</span>().split()]<br>ans = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> data:<br>    ans ^= i<br><span class="hljs-keyword">if</span> ans:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Yes&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;No&quot;</span>)<br></code></pre></td></tr></table></figure>
<h3 id="异或数列">异或数列</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">play</span>(<span class="hljs-params">data</span>):<br>    ans = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> data:<br>        ans ^= i<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ans:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    one = [<span class="hljs-number">0</span>] * <span class="hljs-number">20</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">record</span>(<span class="hljs-params">x</span>):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):<br>            <span class="hljs-keyword">if</span> x &amp; <span class="hljs-number">1</span>:<br>                one[i] += <span class="hljs-number">1</span><br>            x &gt;&gt;= <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> data:<br>        record(i)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">19</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> one[i] &amp; <span class="hljs-number">1</span>:<br>            zero = n - one[i]<br>            <span class="hljs-keyword">if</span> one[i] == <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> (zero &amp; <span class="hljs-number">1</span>):<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())):<br>    l = [<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">input</span>().split()]<br>    n = l[<span class="hljs-number">0</span>]<br>    <span class="hljs-built_in">print</span>(play(l[<span class="hljs-number">1</span>:]))<br></code></pre></td></tr></table></figure>
<h1>图论</h1>
<h2 id="搜索">搜索</h2>
<h3 id="dfs">dfs</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python">m, n = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>inf = m * n<br>track = [[<span class="hljs-literal">True</span>] * m <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br>g = [[<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">input</span>().split()] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br>total = <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">sum</span>, g))<br>half = total // <span class="hljs-number">2</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>():<br>    <span class="hljs-keyword">if</span> half + half != total:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    ans = inf<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">x, y, s, cnt</span>):<br>        <span class="hljs-keyword">nonlocal</span> ans<br>        s += g[x][y]<br>        cnt += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> s &gt; half:<br>            <span class="hljs-keyword">return</span><br>        <span class="hljs-keyword">if</span> s == half:<br>            ans = <span class="hljs-built_in">min</span>(ans, cnt)<br>            <span class="hljs-keyword">return</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">push</span>(<span class="hljs-params">x, y</span>):<br>            <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> &lt;= x &lt; n <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> &lt;= y &lt; m:<br>                <span class="hljs-keyword">if</span> track[x][y]:<br>                    track[x][y] = <span class="hljs-literal">False</span><br>                    dfs(x, y, s, cnt)<br>                    track[x][y] = <span class="hljs-literal">True</span><br>        push(x + <span class="hljs-number">1</span>, y)<br>        push(x - <span class="hljs-number">1</span>, y)<br>        push(x, y + <span class="hljs-number">1</span>)<br>        push(x, y - <span class="hljs-number">1</span>)<br>    dfs(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">if</span> ans &lt; inf:<br>        <span class="hljs-keyword">return</span> ans<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><span class="hljs-built_in">print</span>(solution())<br></code></pre></td></tr></table></figure>
<h3 id="bfs">bfs</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br>q = deque()<br>n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>graph, absent = [[] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)], [<span class="hljs-literal">True</span>] * (n + <span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    a, b = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    graph[a].append(b)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bfs</span>():<br>    steps, absent[<span class="hljs-number">1</span>] = -<span class="hljs-number">1</span>, <span class="hljs-literal">False</span><br>    q.append(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">while</span> q:<br>        steps += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(q)):<br>            v = q.popleft()<br>            <span class="hljs-keyword">if</span> v == n:<br>                <span class="hljs-keyword">return</span> steps<br>            <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> graph[v]:<br>                <span class="hljs-keyword">if</span> absent[w]:<br>                    absent[w] = <span class="hljs-literal">False</span><br>                    q.append(w)<br>    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br><span class="hljs-built_in">print</span>(bfs())<br></code></pre></td></tr></table></figure>
<h4 id="flood-fill">flood fill</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>graph, track = [<span class="hljs-built_in">input</span>() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)], [[<span class="hljs-literal">True</span>] * n <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bfs</span>(<span class="hljs-params">x, y</span>):<br>    filled, q = <span class="hljs-literal">True</span>, deque()<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push</span>(<span class="hljs-params">x, y</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> &lt;= x &lt; n <span class="hljs-keyword">and</span> <span class="hljs-number">0</span> &lt;= y &lt; n:<br>            <span class="hljs-keyword">if</span> graph[x][y] == <span class="hljs-string">&quot;#&quot;</span> <span class="hljs-keyword">and</span> track[x][y]:<br>                track[x][y] = <span class="hljs-literal">False</span><br>                q.append((x, y))<br>            <span class="hljs-keyword">elif</span> graph[x][y] == <span class="hljs-string">&quot;.&quot;</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    push(x, y)<br>    <span class="hljs-keyword">while</span> q:<br>        a, b = q.popleft()<br>        sea = <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">if</span> push(a + <span class="hljs-number">1</span>, b):<br>            sea = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">if</span> push(a - <span class="hljs-number">1</span>, b):<br>            sea = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">if</span> push(a, b + <span class="hljs-number">1</span>):<br>            sea = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">if</span> push(a, b - <span class="hljs-number">1</span>):<br>            sea = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> sea:<br>            filled = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">return</span> filled<br>cnt = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        <span class="hljs-keyword">if</span> graph[i][j] == <span class="hljs-string">&quot;#&quot;</span> <span class="hljs-keyword">and</span> track[i][j]:<br>            <span class="hljs-keyword">if</span> bfs(i, j):<br>                cnt += <span class="hljs-number">1</span><br><span class="hljs-built_in">print</span>(cnt)<br></code></pre></td></tr></table></figure>
<h4 id="最短路计数">最短路计数</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br>mod = <span class="hljs-number">100003</span><br>n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>graph = [[] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    x, y = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    <span class="hljs-keyword">if</span> x != y:<br>        graph[x].append(y)<br>        graph[y].append(x)<br>dist, paths = [<span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>)] * (n + <span class="hljs-number">1</span>), [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br>q = deque()<br>dist[<span class="hljs-number">1</span>], paths[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>, <span class="hljs-number">1</span><br>q.append(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">while</span> q:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(q)):<br>        v = q.popleft()<br>        <span class="hljs-keyword">for</span> vi <span class="hljs-keyword">in</span> graph[v]:<br>            <span class="hljs-keyword">if</span> dist[vi] &gt; dist[v]:<br>                paths[vi] = (paths[vi] + paths[v]) % mod<br>                <span class="hljs-keyword">if</span> dist[vi] == <span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>):<br>                    dist[vi] = dist[v] + <span class="hljs-number">1</span><br>                    q.append(vi)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    <span class="hljs-built_in">print</span>(paths[i])<br></code></pre></td></tr></table></figure>
<h2 id="拓扑排序">拓扑排序</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AdjSet</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, n</span>):<br>        self.n = n<br>        self.in_degree = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br><br>        self.<span class="hljs-built_in">set</span> = [<span class="hljs-built_in">set</span>() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]  <span class="hljs-comment"># default 0 and 1 to n vertex</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, item</span>):<br>        <span class="hljs-keyword">return</span> self.<span class="hljs-built_in">set</span>[item]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_edge</span>(<span class="hljs-params">self, u, v</span>):<br>        <span class="hljs-keyword">if</span> v <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self[u]:<br>            self[u].add(v)<br>            self.in_degree[v] += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">topsort</span>(<span class="hljs-params">self</span>):<br>        n = self.n<br>        in_degree = self.in_degree<br><br>        visited = [<span class="hljs-literal">False</span>] * (n + <span class="hljs-number">1</span>)<br>        res = []<br>        q = deque()<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">push</span>(<span class="hljs-params">v</span>):<br>            <span class="hljs-keyword">if</span> in_degree[v] == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">if</span> visited[v]:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>                     <span class="hljs-comment"># exist cycle</span><br><br>                visited[v] = <span class="hljs-literal">True</span><br>                q.append(v)<br>                res.append(v)<br><br>        <span class="hljs-keyword">for</span> u <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>            push(u)<br><br>        <span class="hljs-keyword">while</span> q:<br>            u = q.popleft()<br><br>            <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> self[u]:<br>                in_degree[v] -= <span class="hljs-number">1</span><br><br>                <span class="hljs-keyword">if</span> push(v):<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(res) == n:                           <span class="hljs-comment"># graph connected</span><br>            <span class="hljs-keyword">return</span> res<br></code></pre></td></tr></table></figure>
<h2 id="最短路径">最短路径</h2>
<p><img src="https://cdn.acwing.com/media/article/image/2019/12/13/1833_db6dffa81d-37ff39642fd8f74476ddcd99944d1b4.png" srcset="/img/loading.gif" lazyload alt=""></p>
<p><img src="https://s2.loli.net/2022/03/06/Dy4eP5hfGHl7k3d.png" srcset="/img/loading.gif" lazyload alt="image-20220306213253357"></p>
<h3 id="Floyd">Floyd</h3>
<p>多源 有负权边 无负权环</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">n, m, k = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>graph = [[<span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>)] * (n + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    graph[i][i] = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    x, y, z = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    graph[x][y] = <span class="hljs-built_in">min</span>(graph[x][y], z)<br><span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>            graph[i][j] = <span class="hljs-built_in">min</span>(graph[i][j], graph[i][v] + graph[v][j])<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(k):<br>    x, y = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    d = graph[x][y]<br>    <span class="hljs-keyword">if</span> d == <span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;impossible&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(d)<br></code></pre></td></tr></table></figure>
<h3 id="Dijkstra">Dijkstra</h3>
<p>单源 无负权边</p>
<p>收集距离源点最近点的过程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AdjList</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, n</span>):<br>        self.n = n<br>        self.<span class="hljs-built_in">list</span> = [&#123;&#125; <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]  <span class="hljs-comment"># default 0 and 1 to n vertex</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, item</span>):<br>        <span class="hljs-keyword">return</span> self.<span class="hljs-built_in">list</span>[item]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_edge</span>(<span class="hljs-params">self, u, v, w</span>):<br>        adj = self[u]<br><br>        adj[v] = <span class="hljs-built_in">min</span>(adj[v], w) <span class="hljs-keyword">if</span> v <span class="hljs-keyword">in</span> adj <span class="hljs-keyword">else</span> w<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dijkstra</span>(<span class="hljs-params">self, a, b</span>):<br>        n = self.n<br>        dist = [<span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;inf&#x27;</span>)] * (n + <span class="hljs-number">1</span>)<br><br>        tree = <span class="hljs-built_in">set</span>()<br>        q = []<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">push</span>(<span class="hljs-params">d_min, v</span>):<br>            <span class="hljs-keyword">if</span> dist[v] &gt; d_min:<br>                dist[v] = d_min<br>                heappush(q, (d_min, v))<br><br>        push(<span class="hljs-number">0</span>, a)<br><br>        <span class="hljs-keyword">while</span> q:<br>            d, v = heappop(q)<br><br>            <span class="hljs-keyword">if</span> v == b:<br>                <span class="hljs-keyword">return</span> d<br><br>            <span class="hljs-keyword">if</span> v <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> tree:<br>                tree.add(v)<br><br>                <span class="hljs-keyword">for</span> u, w <span class="hljs-keyword">in</span> self[v].items():<br>                    d_min = d + w<br>                    push(d_min, u)<br><br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<h3 id="Bellman-Ford">Bellman-Ford</h3>
<p>有边数限制的最短路</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">n, m, k = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>edges, dist = &#123;&#125;, [<span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>)] * (n + <span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    x, y, z = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    <span class="hljs-keyword">if</span> (x, y) <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> edges:<br>        edges[(x, y)] = z<br>    <span class="hljs-keyword">else</span>:<br>        edges[(x, y)] = <span class="hljs-built_in">min</span>(edges[(x, y)], z)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dp</span>(<span class="hljs-params">n, m, k</span>):	<br>    dist[n] = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(k):<br>        last_dist = dist.copy()<br>        <span class="hljs-keyword">for</span> V, w <span class="hljs-keyword">in</span> edges.items():<br>            v1, v2 = V<br>            dist[v2] = <span class="hljs-built_in">min</span>(dist[v2], last_dist[v1] + w)<br>    <span class="hljs-keyword">return</span> dist[m]<br>d = dp(<span class="hljs-number">1</span>, n, k)<br><span class="hljs-keyword">if</span> d == <span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;impossible&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(d)<br></code></pre></td></tr></table></figure>
<h3 id="SPFA">SPFA</h3>
<p>单源 有负权边 有负权环</p>
<h4 id="最短路">最短路</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">spfa</span>(<span class="hljs-params">n, graph, a, b</span>):<br>    <span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br>    dist, q, not_in_q = [<span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>)] * (n + <span class="hljs-number">1</span>), deque(), [<span class="hljs-literal">True</span>] * (n + <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push</span>(<span class="hljs-params">v</span>):<br>        q.append(v)<br>        not_in_q[v] = <span class="hljs-literal">False</span><br>    dist[a] = <span class="hljs-number">0</span><br>    push(a)<br>    <span class="hljs-keyword">while</span> q:<br>        v = q.popleft()<br>        not_in_q[v] = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">for</span> vi, wi <span class="hljs-keyword">in</span> graph[v].items():<br>            <span class="hljs-keyword">if</span> dist[vi] &gt; dist[v] + wi:<br>                dist[vi] = dist[v] + wi<br>                push(vi)<br>    <span class="hljs-keyword">return</span> dist[b]<br></code></pre></td></tr></table></figure>
<h4 id="判断负环">判断负环</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br>n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>graph = [&#123;i: <span class="hljs-number">0</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>)&#125;] + [&#123;&#125; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    x, y, z = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    <span class="hljs-keyword">if</span> y <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> graph[x]:<br>        graph[x][y] = z<br>    <span class="hljs-keyword">else</span>:<br>        graph[x][y] = <span class="hljs-built_in">min</span>(graph[x][y], z)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">spfa</span>():<br>    dist, q, not_in_q = [<span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>)] * (n + <span class="hljs-number">1</span>), deque(), [<span class="hljs-literal">True</span>] * (n + <span class="hljs-number">1</span>)<br>    cnt = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push</span>(<span class="hljs-params">v</span>):<br>        q.append(v)<br>        not_in_q[v] = <span class="hljs-literal">False</span><br>        cnt[v] += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> cnt[v] &gt; n + <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    dist[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span><br>    push(<span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">while</span> q:<br>        v = q.popleft()<br>        not_in_q[v] = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">for</span> vi, wi <span class="hljs-keyword">in</span> graph[v].items():<br>            <span class="hljs-keyword">if</span> dist[vi] &gt; dist[v] + wi:<br>                dist[vi] = dist[v] + wi<br>                <span class="hljs-keyword">if</span> push(vi):<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Yes&quot;</span> <span class="hljs-keyword">if</span> spfa() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;No&quot;</span>)<br></code></pre></td></tr></table></figure>
<h2 id="最小生成树">最小生成树</h2>
<h3 id="prim">prim</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AdjMatrix</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, n</span>):<br>        self.n = n                                  <span class="hljs-comment"># default 0 and 1 to n vertex</span><br>        self.matrix = [[<span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;inf&#x27;</span>)] * (n + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>            self[i][i] = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, item</span>):<br>        <span class="hljs-keyword">return</span> self.matrix[item]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">floyd</span>(<span class="hljs-params">self</span>):<br>        n = self.n<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>                <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>                    self[j][k] = <span class="hljs-built_in">min</span>(self[j][k], self[j][i] + self[i][k])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">prim</span>(<span class="hljs-params">self</span>):<br>        n = self.n<br>        cnt = <span class="hljs-number">0</span><br><br>        dist = [<span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;inf&#x27;</span>)] * (n + <span class="hljs-number">1</span>)<br>        mst = <span class="hljs-built_in">set</span>()<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">u</span>):<br>            mst.add(u)<br>            dist[u] = <span class="hljs-number">0</span><br><br>            <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>                dist[v] = <span class="hljs-built_in">min</span>(dist[v], self[u][v])<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">next</span>():<br>            u = <span class="hljs-number">0</span><br><br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>                <span class="hljs-keyword">if</span> i <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> mst:<br>                    <span class="hljs-keyword">if</span> dist[i] &lt; dist[u]:<br>                        u = i<br><br>            <span class="hljs-keyword">return</span> u<br><br>        update(<span class="hljs-number">1</span>)<br><br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n - <span class="hljs-number">1</span>):<br>            u = <span class="hljs-built_in">next</span>()<br><br>            <span class="hljs-keyword">if</span> u == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">return</span><br><br>            cnt += dist[u]<br>            update(u)<br><br>        <span class="hljs-keyword">return</span> cnt<br></code></pre></td></tr></table></figure>
<h3 id="kruskal">kruskal</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EdgeSet</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, n</span>):<br>        self.n = n<br>        self.edges = &#123;&#125;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">self, u, v, w</span>):<br>        <span class="hljs-keyword">if</span> u == v:<br>            <span class="hljs-keyword">return</span><br><br>        <span class="hljs-keyword">if</span> u &gt; v:<br>            u, v = v, u<br><br>        pair = (u, v)<br>        self.edges[pair] = <span class="hljs-built_in">min</span>(self.edges[pair], w) <span class="hljs-keyword">if</span> pair <span class="hljs-keyword">in</span> self.edges <span class="hljs-keyword">else</span> w<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sort</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sorted</span>([(w, pair) <span class="hljs-keyword">for</span> pair, w <span class="hljs-keyword">in</span> edges.edges.items()])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">kruskal</span>(<span class="hljs-params">self</span>):<br>        n = self.n<br>        <br>        cnt = <span class="hljs-number">0</span><br>        ufs = UFS(n)<br><br>        <span class="hljs-keyword">for</span> w, pair <span class="hljs-keyword">in</span> self.sort():<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ufs.is_connected(*pair):<br>                ufs.union(*pair)<br>                <br>                cnt += w<br><br>        <span class="hljs-keyword">if</span> ufs.get_size(<span class="hljs-number">1</span>) &lt; n:<br>            <span class="hljs-keyword">return</span><br><br>        <span class="hljs-keyword">return</span> cnt<br></code></pre></td></tr></table></figure>
<h2 id="最短Hamilton路径">最短Hamilton路径</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>ST = <span class="hljs-number">1</span> &lt;&lt; n<br>graph = [[<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">input</span>().split()] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br>dp = [[<span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>)] * n <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(ST)]    <span class="hljs-comment"># 从0经过i集合到j点最短距离</span><br>dp[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> st <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(ST):<br>    in_st = <span class="hljs-keyword">lambda</span> v: st &gt;&gt; v &amp; <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> in_st(<span class="hljs-number">0</span>):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            <span class="hljs-keyword">if</span> in_st(i):<br>                <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>                    <span class="hljs-keyword">if</span> in_st(j):<br>                        dp[st][i] = <span class="hljs-built_in">min</span>(dp[st][i],<br>                                        dp[st - (<span class="hljs-number">1</span> &lt;&lt; i)][j] + graph[j][i])<br><span class="hljs-built_in">print</span>(dp[ST - <span class="hljs-number">1</span>][n - <span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure>
<h1>计算几何</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">lines = <span class="hljs-built_in">set</span>()<br>n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br><span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>        <span class="hljs-keyword">for</span> yi <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(y + <span class="hljs-number">1</span>, n):<br>            <span class="hljs-keyword">for</span> xi <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>                <span class="hljs-keyword">if</span> x != xi:<br>                    k = (y - yi) / (x - xi)<br>                    b = y - k * x<br>                    lines.add((<span class="hljs-built_in">round</span>(k, <span class="hljs-number">8</span>), <span class="hljs-built_in">round</span>(b, <span class="hljs-number">8</span>)))<br><span class="hljs-built_in">print</span>(n + m + <span class="hljs-built_in">len</span>(lines))<br></code></pre></td></tr></table></figure>
<h2 id="平面几何">平面几何</h2>
<h3 id="偏差量">偏差量</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">eps = <span class="hljs-number">1e-8</span><br></code></pre></td></tr></table></figure>
<h3 id="等于0">等于0</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">zero</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">if</span> x &gt;= eps:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> x &lt;= -eps:<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<h3 id="相等">相等</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">eq</span>(<span class="hljs-params">x, y</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">abs</span>(x - y) &lt; eps:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">if</span> x &gt; y:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<h3 id="平面划分">平面划分</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">eps = <span class="hljs-number">1e-8</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">eq</span>(<span class="hljs-params">x, y</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">abs</span>(x - y) &lt; eps:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">if</span> x &gt; y:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>lines = &#123;<span class="hljs-built_in">tuple</span>(<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">input</span>().split()) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)&#125;<br>track, cnt = [lines.pop()], <span class="hljs-number">2</span><br><span class="hljs-keyword">for</span> a1, b1 <span class="hljs-keyword">in</span> lines:<br>    cnt += <span class="hljs-number">1</span><br>    points = <span class="hljs-built_in">set</span>()<br>    <span class="hljs-keyword">for</span> a2, b2 <span class="hljs-keyword">in</span> track:<br>        <span class="hljs-keyword">if</span> eq(a1, a2):<br>            p = (-(b1 - b2) / (a1 - a2), (a1 * b2 - a2 * b1) / (a1 - a2))<br>            <span class="hljs-keyword">if</span> p <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> points:<br>                cnt += <span class="hljs-number">1</span><br>                points.add(p)<br>    track.append((a1, b1))<br><span class="hljs-built_in">print</span>(cnt)<br></code></pre></td></tr></table></figure>
<h2 id="点叉积">点叉积</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">dot = <span class="hljs-keyword">lambda</span> a, b: <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> i: a[i] * b[i], <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(a))))<br>size = <span class="hljs-keyword">lambda</span> a: dot(a, a) ** <span class="hljs-number">0.5</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cross</span>(<span class="hljs-params">a, b</span>):<br>    x1, y1 = a<br>    x2, y2 = b<br>    <span class="hljs-keyword">return</span> x1 * y2 - x2 * y1<br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">solution</span>():<br>    x0, y0 = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    x1, y1 = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    x2, y2 = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    a, b = (x1 - x0, y1 - y0), (x2 - x0, y2 - y0)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">abs</span>(cross(a, b)) / <span class="hljs-number">2</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">format</span>(solution(), <span class="hljs-string">&quot;.2f&quot;</span>))<br></code></pre></td></tr></table></figure>
<h3 id="点和直线的位置关系"><strong>点和直线的位置关系</strong></h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())):<br>    x1, y1 = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    x2, y2 = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    x, y = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    ab = (x2 - x1, y2 - y1)<br>    p = (x - x1, y - y1)<br>    d = zero(cross(p, ab))<br>    <span class="hljs-keyword">if</span> d == <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;IN&quot;</span>)<br>    <span class="hljs-keyword">elif</span> d &gt; <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;R&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;L&quot;</span>)<br></code></pre></td></tr></table></figure>
<h3 id="点和线段关系">点和线段关系</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())):<br>    x1, y1 = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    x2, y2 = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    x, y = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    ab = (x2 - x1, y2 - y1)<br>    p = (x - x1, y - y1)<br>    d, product = zero(cross(p, ab)), zero(dot(p, ab))<br>    <span class="hljs-keyword">if</span> d == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> product &gt;= <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Yes&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;No&quot;</span>)<br></code></pre></td></tr></table></figure>
<h3 id="点到直线的距离"><strong>点到直线的距离</strong></h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">height</span>(<span class="hljs-params">a, b, p</span>):<br>    x1, y1 = a<br>    x2, y2 = b<br>    x, y = p<br>    v = (x - x1, y - y1)<br>    ab = (x2 - x1, y2 - y1)<br>    s = <span class="hljs-built_in">abs</span>(cross(v, ab))<br>    <span class="hljs-keyword">return</span> s / size(ab)<br></code></pre></td></tr></table></figure>
<h3 id="点关于直线的对称点"><strong>点关于直线的对称点</strong></h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">plus</span>(<span class="hljs-params">a, b</span>):<br>    x1, y1 = a<br>    x2, y2 = b<br>    <span class="hljs-keyword">return</span> (x1 + x2, y1 + y2)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">minus</span>(<span class="hljs-params">a, b</span>):<br>    x1, y1 = a<br>    x2, y2 = b<br>    <span class="hljs-keyword">return</span> (x1 - x2, y1 - y2)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">K</span>(<span class="hljs-params">p, k</span>):<br>    x, y = p<br>    <span class="hljs-keyword">return</span> (k * x, k * y)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dot</span>(<span class="hljs-params">a, b</span>):<br>    x1, y1 = a<br>    x2, y2 = b<br>    <span class="hljs-keyword">return</span> x1 * x2 + y1 * y2<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">projection</span>(<span class="hljs-params">a, b, p</span>):<br>    v = minus(b, a)<br>    l = minus(p, a)<br>    k = dot(v, l) / dot(v, v)<br>    <span class="hljs-keyword">return</span> plus(a, K(v, k))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">symmetry</span>(<span class="hljs-params">a, b, p</span>):<br>    <span class="hljs-keyword">return</span> minus(K(projection(a, b, p), <span class="hljs-number">2</span>), p)<br><span class="hljs-built_in">print</span>(symmetry((<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>), (<span class="hljs-number">0</span>, <span class="hljs-number">3</span>)))<br></code></pre></td></tr></table></figure>
<h3 id="两条直线的位置关系"><strong>两条直线的位置关系</strong></h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">relation</span>(<span class="hljs-params">a, b, c, d</span>):<br>    v1 = minus(b, a)<br>    v2 = minus(d, c)<br>    <span class="hljs-keyword">if</span> zero(cross(v1, v2)) == <span class="hljs-number">0</span>:<br>        v = minus(c, a)<br>        <span class="hljs-keyword">if</span> zero(cross(v1, v)) == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;重合&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;平行&quot;</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;相交&quot;</span><br></code></pre></td></tr></table></figure>
<h2 id="扫描线（无离散化）">扫描线（无离散化）</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python">length = <span class="hljs-number">10001</span><br>L = length &lt;&lt; <span class="hljs-number">2</span> | <span class="hljs-number">1</span><br>left, right, cnt, s = [<span class="hljs-number">0</span>] * L, [<span class="hljs-number">0</span>] * L, [<span class="hljs-number">0</span>] * L, [<span class="hljs-number">0</span>] * L<br>ls, rs = <span class="hljs-keyword">lambda</span> k: k &lt;&lt; <span class="hljs-number">1</span>, <span class="hljs-keyword">lambda</span> k: k &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span><br>m = <span class="hljs-keyword">lambda</span> k: left[k] + right[k] &gt;&gt; <span class="hljs-number">1</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">build</span>(<span class="hljs-params">k, l, r</span>):<br>    left[k], right[k] = l, r<br>    <span class="hljs-keyword">if</span> l &lt; r:<br>        build(ls(k), l, m(k))<br>        build(rs(k), m(k) + <span class="hljs-number">1</span>, r)<br>build(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, length)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">modify</span>(<span class="hljs-params">k, l, r, x</span>):<br>    <span class="hljs-keyword">if</span> l &lt;= left[k] <span class="hljs-keyword">and</span> right[k] &lt;= r:<br>        cnt[k] += x<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span> l &lt;= m(k):<br>            modify(ls(k), l, r, x)<br>        <span class="hljs-keyword">if</span> m(k) &lt; r:<br>            modify(rs(k), l, r, x)<br>    <span class="hljs-keyword">if</span> cnt[k] &gt; <span class="hljs-number">0</span>:<br>        s[k] = right[k] - left[k] + <span class="hljs-number">1</span><br>    <span class="hljs-keyword">elif</span> left[k] == right[k]:<br>        s[k] = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">else</span>:<br>        s[k] = s[ls(k)] + s[rs(k)]<br>n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>lines = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    x1, y1, x2, y2 = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    lines.append((x1, y1, y2, <span class="hljs-number">1</span>))<br>    lines.append((x2, y1, y2, -<span class="hljs-number">1</span>))<br>lines.sort()<br>result = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n &lt;&lt; <span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">if</span> i:<br>        result += (lines[i][<span class="hljs-number">0</span>] - lines[i - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>]) * s[<span class="hljs-number">1</span>]<br>    modify(<span class="hljs-number">1</span>, lines[i][<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>, lines[i][<span class="hljs-number">2</span>], lines[i][<span class="hljs-number">3</span>])<br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure>
<h1>位运算</h1>
<h2 id="右移左移">右移左移</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">13</span> &gt;&gt; <span class="hljs-number">1</span><br>Out[<span class="hljs-number">3</span>]: <span class="hljs-number">6</span><br><span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">3</span><br>Out[<span class="hljs-number">4</span>]: <span class="hljs-number">8</span><br><br></code></pre></td></tr></table></figure>
<h2 id="取位">取位</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">n = <span class="hljs-number">13</span>    <span class="hljs-comment"># 1101</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>    <span class="hljs-built_in">print</span>((n &gt;&gt; i) &amp; <span class="hljs-number">1</span>)<br>    <br><span class="hljs-number">1</span><br><span class="hljs-number">0</span><br><span class="hljs-number">1</span><br><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<h2 id="置1">置1</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">setbit</span>(<span class="hljs-params">x, k</span>):		<span class="hljs-comment"># 从第0位计数</span><br>    n = <span class="hljs-number">1</span> &lt;&lt; k<br>    <span class="hljs-keyword">return</span> x | n<br>setbit(<span class="hljs-number">8</span>, <span class="hljs-number">1</span>)<br>Out[<span class="hljs-number">2</span>]: <span class="hljs-number">10</span><br></code></pre></td></tr></table></figure>
<h2 id="异或">异或</h2>
<p>逐位异真，同假</p>
<p>不进位加法</p>
<p>遇0不变，遇1反转</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">a = <span class="hljs-number">10010</span> <span class="hljs-comment"># 18</span><br>b = <span class="hljs-number">11100</span> <span class="hljs-comment"># </span><br>a = <span class="hljs-number">18</span> <span class="hljs-comment"># 10010</span><br>b = <span class="hljs-number">28</span> <span class="hljs-comment"># 11100</span><br>c = a ^ b<br>c	<span class="hljs-comment"># 01110</span><br>Out[<span class="hljs-number">10</span>]: <span class="hljs-number">14</span><br><span class="hljs-literal">True</span> ^ <span class="hljs-literal">True</span><br>Out[<span class="hljs-number">12</span>]: <span class="hljs-literal">False</span><br><span class="hljs-literal">True</span> ^ <span class="hljs-literal">False</span><br>Out[<span class="hljs-number">13</span>]: <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure>
<h3 id="只出现一次的数字">只出现一次的数字</h3>
<p>数组除了某个元素只出现一次以外，其余每个元素均出现两次。找出那个只出现了一次的元素</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">singleNumber</span>(<span class="hljs-params">nums</span>):<br>    ans = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> nums:<br>        ans ^= i<br><br>        <span class="hljs-keyword">return</span> ans<br></code></pre></td></tr></table></figure>
<h2 id="lowbit">lowbit</h2>
<p>函数的值是x的二进制表达式中最低位的1所对应的值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">lowbit = <span class="hljs-keyword">lambda</span> x: x &amp; (-x)<br>lowbit(<span class="hljs-number">8</span>)<br>Out[<span class="hljs-number">3</span>]: <span class="hljs-number">8</span><br>lowbit(<span class="hljs-number">9</span>)<br>Out[<span class="hljs-number">4</span>]: <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>
<h1>数据结构</h1>
<h2 id="串">串</h2>
<h3 id="基本操作">基本操作</h3>
<h4 id="find">find</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">s.find(sub, start=<span class="hljs-number">0</span>, end=<span class="hljs-built_in">len</span>(s))<br></code></pre></td></tr></table></figure>
<p>s.find(sub, start=0, end=len(s))</p>
<p>matching index range: [start, end)</p>
<p>return the first index of the first match, or -1 if no match</p>
<h4 id="count">count</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">s.count(sub, start=<span class="hljs-number">0</span>, end=<span class="hljs-built_in">len</span>(s))<br></code></pre></td></tr></table></figure>
<p>count the number of the whole, independent matches</p>
<h3 id="前后缀函数">前后缀函数</h3>
<h4 id="最大公共真前后缀">最大公共真前后缀</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">max_fix</span>(<span class="hljs-params">s</span>):<br>    max_same = [<span class="hljs-number">0</span>] * <span class="hljs-built_in">len</span>(s)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(s)):<br>        j = i - <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">while</span> j &gt;= <span class="hljs-number">0</span>:<br>            pi = max_same[j]<br><br>            <span class="hljs-keyword">if</span> s[i] == s[pi]:<br>                max_same[i] = pi + <span class="hljs-number">1</span><br>                <span class="hljs-keyword">break</span><br><br>            j = pi - <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">return</span> max_same<br></code></pre></td></tr></table></figure>
<h4 id="最小公共真前后缀">最小公共真前后缀</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">min_fix</span>(<span class="hljs-params">s</span>):<br>    min_same = max_fix(s)<br>    <br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(s)):<br>        j = i   <span class="hljs-comment"># initial j as i &gt; 0</span><br><br>        <span class="hljs-keyword">while</span> pi := min_same[j]:    <span class="hljs-comment"># ensure j and pi &gt; 0</span><br>            min_same[i] = pi<br>            j = pi - <span class="hljs-number">1</span>  <span class="hljs-comment"># worst j is 0</span><br><br>    <span class="hljs-keyword">return</span> min_same<br></code></pre></td></tr></table></figure>
<h4 id="kmp">kmp</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">kmp</span>(<span class="hljs-params">s, p</span>):<br>    new = p + <span class="hljs-string">&#x27;#&#x27;</span> + s<br>    max_same = max_fix(new)<br>    s, p = <span class="hljs-built_in">len</span>(s), <span class="hljs-built_in">len</span>(p)<br><br>    <span class="hljs-keyword">return</span> [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(s - p + <span class="hljs-number">1</span>) <span class="hljs-keyword">if</span> max_same[i + <span class="hljs-number">2</span> * p] == p]<br></code></pre></td></tr></table></figure>
<h2 id="单调栈">单调栈</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">largestRectangleArea</span>(<span class="hljs-params">heights</span>):<br>    n = <span class="hljs-built_in">len</span>(heights)<br>    heights = [-<span class="hljs-number">2</span>] + heights + [-<span class="hljs-number">1</span>]<br>    stack = [(-<span class="hljs-number">2</span>, <span class="hljs-number">0</span>)]<br>    left, right = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">2</span>), [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push</span>(<span class="hljs-params">h, p</span>):<br>        top_h, top_p = stack[-<span class="hljs-number">1</span>]<br>        <span class="hljs-keyword">while</span> top_h &gt;= h:<br>            <span class="hljs-keyword">if</span> top_h &gt; h:<br>                right[top_p] = p<br>            stack.pop()<br>            top_h, top_p = stack[-<span class="hljs-number">1</span>]<br>        left[p] = top_p<br>        stack.append((h, p))<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">2</span>):<br>        push(heights[i], i)<br>    m = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>        m = <span class="hljs-built_in">max</span>(m, heights[i] * (right[i] - left[i] - <span class="hljs-number">1</span>))<br>    <span class="hljs-keyword">return</span> m<br></code></pre></td></tr></table></figure>
<h2 id="单调队列">单调队列</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MonotonicQueue</span>:<br>    <span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, <span class="hljs-built_in">type</span>, sub=[]</span>):<br>        self.<span class="hljs-built_in">type</span> = <span class="hljs-built_in">type</span> == <span class="hljs-string">&#x27;decrease&#x27;</span><br><br>        self.queue = self.deque()<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> sub:<br>            self.push(i)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">head</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.queue[<span class="hljs-number">0</span>]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">is_monotonic</span>(<span class="hljs-params">self, x</span>):<br>        tail = self.queue[-<span class="hljs-number">1</span>]<br><br>        <span class="hljs-keyword">return</span> tail &gt;= x <span class="hljs-keyword">if</span> self.<span class="hljs-built_in">type</span> <span class="hljs-keyword">else</span> tail &lt;= x<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-keyword">while</span> self.queue <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> self.is_monotonic(x):<br>            self.queue.pop()<br><br>        self.queue.append(x)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pop</span>(<span class="hljs-params">self, value</span>):<br>        <span class="hljs-keyword">if</span> self.head() == value:<br>            self.queue.popleft()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">maxSlidingWindow</span>(<span class="hljs-params">self, nums, k</span>):<br>        maxs = []<br><br>        decrease_queue = MonotonicQueue(<span class="hljs-string">&#x27;decrease&#x27;</span>, nums[: k])<br>        maxs.append(decrease_queue.head())<br><br>        <span class="hljs-keyword">for</span> old_left <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(nums) - k):<br>            new_right = old_left + k<br>            <br>            old_left = nums[old_left]<br>            new_right = nums[new_right]<br><br>            decrease_queue.pop(old_left)<br>            decrease_queue.push(new_right)<br><br>            maxs.append(decrease_queue.head())<br>        <br>        <span class="hljs-keyword">return</span> maxs<br></code></pre></td></tr></table></figure>
<h2 id="并查集">并查集</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UFS</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, n</span>):<br>        self.n = n<br>        self.f = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>))<br><br>        self.size = [<span class="hljs-number">1</span>] * (n + <span class="hljs-number">1</span>)<br>        self.dist = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">is_root</span>(<span class="hljs-params">self, a</span>):<br>        <span class="hljs-keyword">return</span> a == self.f[a]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">is_connected</span>(<span class="hljs-params">self, a, b</span>):<br>        <span class="hljs-keyword">return</span> self.find(a) == self.find(b)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">find</span>(<span class="hljs-params">self, a</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.is_root(a):<br>            f = self.f[a]<br>            self.f[a] = self.find(f)<br><br>            <span class="hljs-keyword">pass</span>                                <span class="hljs-comment"># update dist</span><br><br>        <span class="hljs-keyword">return</span> self.f[a]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">union</span>(<span class="hljs-params">self, a, b</span>):                      <span class="hljs-comment"># a branch, b root</span><br>        root_a, root_b = self.find(a), self.find(b)<br><br>        <span class="hljs-keyword">if</span> root_a != root_b:<br>            self.f[root_a] = root_b<br><br>            <span class="hljs-keyword">pass</span>                                <span class="hljs-comment"># update dist</span><br>            self.size[root_b] += self.size[root_a]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_roots</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, self.n + <span class="hljs-number">1</span>) <span class="hljs-keyword">if</span> self.is_root(i)]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_size</span>(<span class="hljs-params">self, a</span>):<br>        root = self.find(a)<br>        <span class="hljs-keyword">return</span> self.size[root]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calc_dist</span>(<span class="hljs-params">self, a, b</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.is_connected(a, b):<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">return</span> self.dist[a] - self.dist[b]<br></code></pre></td></tr></table></figure>
<h2 id="前缀和">前缀和</h2>
<h3 id="静态">静态</h3>
<h4 id="1维">1维</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>l = [<span class="hljs-number">0</span>] + [<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">input</span>().split()]<br>s = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    s[i] = s[i - <span class="hljs-number">1</span>] + l[i]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>():<br>    l, r = [<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">input</span>().split()]<br>    <span class="hljs-keyword">return</span> s[r] - s[l - <span class="hljs-number">1</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    <span class="hljs-built_in">print</span>(query())<br></code></pre></td></tr></table></figure>
<h4 id="2维">2维</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PrefixArea</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, matrix</span>):                 <span class="hljs-comment"># matrix extend 0</span><br>        n = <span class="hljs-built_in">len</span>(matrix)<br>        m = <span class="hljs-built_in">len</span>(matrix[<span class="hljs-number">0</span>])<br><br>        self.area = [[<span class="hljs-number">0</span>] * m <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n):<br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, m):<br>                self.area[i][j] = matrix[i][j] + self.two_area(i - <span class="hljs-number">1</span>, j - <span class="hljs-number">1</span>, i, j)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">two_area</span>(<span class="hljs-params">self, x1, y1, x2, y2</span>):         <span class="hljs-comment"># x1 &lt;= x2, y1 &lt;= y2</span><br>        <span class="hljs-keyword">return</span> self.area[x1][y2] + self.area[x2][y1] - self.area[x1][y1]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">self, x1, y1, x2, y2</span>):<br>        <span class="hljs-keyword">return</span> self.area[x2][y2] - self.two_area(x1 - <span class="hljs-number">1</span>, y1 - <span class="hljs-number">1</span>, x2, y2)<br></code></pre></td></tr></table></figure>
<h3 id="树状数组">树状数组</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python">n, times = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>lowbit = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: x &amp; (-x), <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)))<br>l = [<span class="hljs-number">0</span>] + [<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">input</span>().split()]<br>s = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">k, x</span>):<br>    l[k] += x<br>    pos = k<br>    <span class="hljs-keyword">while</span> pos &lt; n + <span class="hljs-number">1</span>:<br>        s[pos] += x<br>        pos += lowbit[pos]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">k</span>):<br>    result = <span class="hljs-number">0</span><br>    pos = k<br>    <span class="hljs-keyword">while</span> pos:<br>        result += s[pos]<br>        pos -= lowbit[pos]<br>    <span class="hljs-keyword">return</span> result<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    add(i, l[i])<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(times):<br>    k, a, b = [<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">input</span>().split()]<br>    <span class="hljs-keyword">if</span> k:<br>        add(a, b)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(query(b) - query(a - <span class="hljs-number">1</span>))<br></code></pre></td></tr></table></figure>
<h2 id="差分">差分</h2>
<h3 id="1维-2">1维</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>l = [<span class="hljs-number">0</span>] + [<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">input</span>().split()] + [<span class="hljs-number">0</span>]<br>delt = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">2</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    delt[i] = l[i] - l[i - <span class="hljs-number">1</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">modify</span>(<span class="hljs-params">l, r, x</span>):<br>    delt[l] += x<br>    delt[r + <span class="hljs-number">1</span>] -= x<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    a, b, c = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    modify(a, b, c)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    l[i] = l[i - <span class="hljs-number">1</span>] + delt[i]<br>    <span class="hljs-built_in">print</span>(l[i], end = <span class="hljs-string">&quot; &quot;</span>)<br></code></pre></td></tr></table></figure>
<h3 id="2维-2">2维</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">n, m, q = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>delt = [[<span class="hljs-number">0</span>] * (m + <span class="hljs-number">2</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">2</span>)]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">modify</span>(<span class="hljs-params">x1, y1, x2, y2, c</span>):<br>    delt[x1][y1] += c<br>    delt[x2 + <span class="hljs-number">1</span>][y2 + <span class="hljs-number">1</span>] += c<br>    delt[x2 + <span class="hljs-number">1</span>][y1] -= c<br>    delt[x1][y2 + <span class="hljs-number">1</span>] -= c<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    data = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, m + <span class="hljs-number">1</span>):<br>        modify(i, j, i, j, <span class="hljs-built_in">next</span>(data))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(q):<br>    a, b, c, d, e = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    modify(a, b, c, d, e)<br>matrix = [[<span class="hljs-number">0</span>] * (m + <span class="hljs-number">2</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">2</span>)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, m + <span class="hljs-number">1</span>):<br>        matrix[i][j] = delt[i][j] - matrix[i - <span class="hljs-number">1</span>][j - <span class="hljs-number">1</span>] + \<br>                       matrix[i][j - <span class="hljs-number">1</span>] + matrix[i - <span class="hljs-number">1</span>][j]<br>        <span class="hljs-built_in">print</span>(matrix[i][j], end = <span class="hljs-string">&quot; &quot;</span>)<br>    <span class="hljs-built_in">print</span>()<br></code></pre></td></tr></table></figure>
<h2 id="st表">st表</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> log2<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">n, l</span>):<br>    bottom = <span class="hljs-built_in">int</span>(log2(n))<br>    st = [l] + [[<span class="hljs-number">0</span>] * n <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(bottom)]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, bottom + <span class="hljs-number">1</span>):<br>        j = <span class="hljs-number">0</span><br>        tail = j + (<span class="hljs-number">1</span> &lt;&lt; i) - <span class="hljs-number">1</span><br>        <span class="hljs-keyword">while</span> tail &lt;= n - <span class="hljs-number">1</span>:<br>            interval = <span class="hljs-number">1</span> &lt;&lt; (i - <span class="hljs-number">1</span>)<br>            st[i][j] = <span class="hljs-built_in">max</span>(st[i - <span class="hljs-number">1</span>][j], st[i - <span class="hljs-number">1</span>][j + interval])<br>            j += <span class="hljs-number">1</span><br>            tail = j + (<span class="hljs-number">1</span> &lt;&lt; i) - <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> st<br>n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>st_table = process(n, [<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">input</span>().split()])<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">l, r</span>):<br>    k = <span class="hljs-built_in">int</span>(log2(r - l + <span class="hljs-number">1</span>))<br>    interval = (<span class="hljs-number">1</span> &lt;&lt; k) - <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">max</span>(st_table[k][l], st_table[k][r - interval])<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>    a, b = [<span class="hljs-built_in">int</span>(x) - <span class="hljs-number">1</span> <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">input</span>().split()]<br>    <span class="hljs-built_in">print</span>(query(a, b))<br></code></pre></td></tr></table></figure>
<h2 id="平衡树">平衡树</h2>
<h3 id="线段树">线段树</h3>
<p>记录n个元素，线段树空间开到4*n</p>
<h4 id="单点修改">单点修改</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python">length, times = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>L = length &lt;&lt; <span class="hljs-number">2</span> | <span class="hljs-number">1</span><br>left, right, s = [<span class="hljs-number">0</span>] * L, [<span class="hljs-number">0</span>] * L, [<span class="hljs-number">0</span>] * L<br>data = [<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">input</span>().split()]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">push</span>(<span class="hljs-params">k</span>):<br>    s[k] = <span class="hljs-built_in">max</span>(s[k &lt;&lt; <span class="hljs-number">1</span>], s[(k &lt;&lt; <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>])<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">build</span>(<span class="hljs-params">k, l, r</span>):<br>    left[k], right[k] = l, r<br>    <span class="hljs-keyword">if</span> l == r:<br>        s[k] = data[l - <span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">else</span>:<br>        m = l + r &gt;&gt; <span class="hljs-number">1</span><br>        build(k &lt;&lt; <span class="hljs-number">1</span>, l, m)<br>        build((k &lt;&lt; <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>, m + <span class="hljs-number">1</span>, r)<br>        push(k)<br>build(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, length)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">k, l, r</span>):<br>    <span class="hljs-keyword">if</span> l &lt;= left[k] <span class="hljs-keyword">and</span> right[k] &lt;= r:<br>        <span class="hljs-keyword">return</span> s[k]<br>    m = left[k] + right[k] &gt;&gt; <span class="hljs-number">1</span><br>    result = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">if</span> l &lt;= m:<br>        result = query(k &lt;&lt; <span class="hljs-number">1</span>, l, r)<br>    <span class="hljs-keyword">if</span> m &lt; r:<br>        result = <span class="hljs-built_in">max</span>(result, query((k &lt;&lt; <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>, l, r))<br>    <span class="hljs-keyword">return</span> result<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">modify</span>(<span class="hljs-params">k, n, x</span>):<br>    <span class="hljs-keyword">if</span> left[k] == right[k]:<br>        s[k] = x<br>    <span class="hljs-keyword">else</span>:<br>        m = left[k] + right[k] &gt;&gt; <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> n &lt;= m:<br>            modify(k &lt;&lt; <span class="hljs-number">1</span>, n, x)<br>        <span class="hljs-keyword">else</span>:<br>            modify((k &lt;&lt; <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>, n, x)<br>        push(k)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(times):<br>    k, a, b = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    <span class="hljs-keyword">if</span> k:<br>        modify(<span class="hljs-number">1</span>, a, b)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(query(<span class="hljs-number">1</span>, a, b))<br></code></pre></td></tr></table></figure>
<h4 id="区间修改">区间修改</h4>
<h5 id="求和-2">求和</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs python">ls = <span class="hljs-keyword">lambda</span> k: <span class="hljs-number">2</span> * k<br>rs = <span class="hljs-keyword">lambda</span> k: <span class="hljs-number">2</span> * k + <span class="hljs-number">1</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SumSegmentTree</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, array</span>):  <span class="hljs-comment"># element index starts from 0</span><br>        self.n = <span class="hljs-built_in">len</span>(array)<br>        size = <span class="hljs-number">4</span> * self.n<br><br>        self.array = [<span class="hljs-number">0</span>] + array<br><br>        self.left, self.right = [<span class="hljs-number">0</span>] * size, [<span class="hljs-number">0</span>] * size<br>        self.value, self.tag = [<span class="hljs-number">0</span>] * size, [<span class="hljs-number">0</span>] * size<br><br>        self.build(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, self.n)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">m</span>(<span class="hljs-params">self, k</span>):<br>        <span class="hljs-keyword">return</span> (self.left[k] + self.right[k]) // <span class="hljs-number">2</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">length</span>(<span class="hljs-params">self, k</span>):<br>        <span class="hljs-keyword">return</span> self.right[k] - self.left[k] + <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">self, k, delt</span>):<br>        self.tag[k] += delt<br>        self.value[k] += delt * self.length(k)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push_up</span>(<span class="hljs-params">self, k</span>):<br>        self.value[k] = self.value[ls(k)] + self.value[rs(k)]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push_down</span>(<span class="hljs-params">self, k</span>):<br>        delt = self.tag[k]<br>        self.update(ls(k), delt), self.update(rs(k), delt)<br>        self.tag[k] = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">build</span>(<span class="hljs-params">self, k, l, r</span>):<br>        self.left[k], self.right[k] = l, r<br><br>        <span class="hljs-keyword">if</span> l == r:<br>            self.value[k] = self.array[l]<br>        <span class="hljs-keyword">else</span>:<br>            m = self.m(k)<br><br>            self.build(ls(k), l, m)<br>            self.build(rs(k), m + <span class="hljs-number">1</span>, r)<br>            self.push_up(k)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_modify</span>(<span class="hljs-params">self, k, a, b, delt</span>):<br>        <span class="hljs-keyword">if</span> a &lt;= self.left[k] <span class="hljs-keyword">and</span> self.right[k] &lt;= b:<br>            self.update(k, delt)<br>        <span class="hljs-keyword">else</span>:<br>            self.push_down(k)<br>            m = self.m(k)<br><br>            <span class="hljs-keyword">if</span> a &lt;= m:<br>                self._modify(ls(k), a, b, delt)<br>            <span class="hljs-keyword">if</span> b &gt; m:<br>                self._modify(rs(k), a, b, delt)<br>            self.push_up(k)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_query</span>(<span class="hljs-params">self, k, a, b</span>):<br>        <span class="hljs-keyword">if</span> a &lt;= self.left[k] <span class="hljs-keyword">and</span> self.right[k] &lt;= b:<br>            <span class="hljs-keyword">return</span> self.value[k]<br><br>        self.push_down(k)<br><br>        res = <span class="hljs-number">0</span><br><br>        m = self.m(k)<br>        <span class="hljs-keyword">if</span> a &lt;= m:<br>            res += self._query(ls(k), a, b)<br>        <span class="hljs-keyword">if</span> m &lt; b:<br>            res += self._query(rs(k), a, b)<br><br>        <span class="hljs-keyword">return</span> res<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">modify</span>(<span class="hljs-params">self, a, b, delt</span>):<br>        self._modify(<span class="hljs-number">1</span>, a, b, delt)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">self, a, b</span>):<br>        <span class="hljs-keyword">return</span> self._query(<span class="hljs-number">1</span>, a, b)<br></code></pre></td></tr></table></figure>
<h6 id="链式">链式</h6>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, left, right</span>):<br>        self.left, self.right = left, right<br>        self.ls, self.rs = <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br><br>        self.value = <span class="hljs-number">0</span><br>        self.tag = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">mid</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> (self.left + self.right) // <span class="hljs-number">2</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">length</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.right - self.left + <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">self, delt</span>):<br>        self.tag += delt<br>        self.value += delt * self.length()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push_up</span>(<span class="hljs-params">self</span>):<br>        self.value = self.ls.value + self.rs.value<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push_down</span>(<span class="hljs-params">self</span>):<br>        delt = self.tag<br>        self.ls.update(delt), self.rs.update(delt)<br>        self.tag = <span class="hljs-number">0</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SegmentTree</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, array_in</span>):<br>        n = <span class="hljs-built_in">len</span>(array_in)<br>        array = [<span class="hljs-number">0</span>] + array_in<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">build</span>(<span class="hljs-params">left, right</span>):<br>            node = Node(left, right)<br><br>            <span class="hljs-keyword">if</span> left == right:<br>                node.value = array[left]<br>            <span class="hljs-keyword">else</span>:<br>                m = node.mid()<br><br>                node.ls = build(left, m)<br>                node.rs = build(m + <span class="hljs-number">1</span>, right)<br><br>                node.push_up()<br><br>            <span class="hljs-keyword">return</span> node<br><br>        self.root = build(<span class="hljs-number">1</span>, n)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">modify</span>(<span class="hljs-params">self, left, right, delt</span>):<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">node</span>):<br>            <span class="hljs-keyword">if</span> left &lt;= node.left <span class="hljs-keyword">and</span> node.right &lt;= right:<br>                node.update(delt)<br>            <span class="hljs-keyword">else</span>:<br>                node.push_down()<br><br>                m = node.mid()<br><br>                <span class="hljs-keyword">if</span> left &lt;= m:<br>                    dfs(node.ls)<br>                <span class="hljs-keyword">if</span> right &gt; m:<br>                    dfs(node.rs)<br><br>                node.push_up()<br><br>        dfs(self.root)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">self, left, right</span>):<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">node</span>):<br>            <span class="hljs-keyword">if</span> left &lt;= node.left <span class="hljs-keyword">and</span> node.right &lt;= right:<br>                <span class="hljs-keyword">return</span> node.value<br><br>            node.push_down()<br><br>            res = <span class="hljs-number">0</span><br>            m = node.mid()<br><br>            <span class="hljs-keyword">if</span> left &lt;= m:<br>                res += dfs(node.ls)<br>            <span class="hljs-keyword">if</span> m &lt; right:<br>                res += dfs(node.rs)<br><br>            <span class="hljs-keyword">return</span> res<br><br>        <span class="hljs-keyword">return</span> dfs(self.root)<br></code></pre></td></tr></table></figure>
<h5 id="最值-2">最值</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs python">ls = <span class="hljs-keyword">lambda</span> k: <span class="hljs-number">2</span> * k<br>rs = <span class="hljs-keyword">lambda</span> k: <span class="hljs-number">2</span> * k + <span class="hljs-number">1</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ValueSegmentTree</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, array</span>):  <span class="hljs-comment"># element index starts from 0</span><br>        self.n = <span class="hljs-built_in">len</span>(array)<br>        size = <span class="hljs-number">4</span> * self.n<br><br>        self.array = [<span class="hljs-number">0</span>] + array<br><br>        self.left, self.right = [<span class="hljs-number">0</span>] * size, [<span class="hljs-number">0</span>] * size<br><br>        self.<span class="hljs-built_in">max</span> = [<span class="hljs-number">0</span>] * size<br>        self.<span class="hljs-built_in">min</span> = [<span class="hljs-number">0</span>] * size<br><br>        self.build(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, self.n)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">m</span>(<span class="hljs-params">self, k</span>):<br>        <span class="hljs-keyword">return</span> (self.left[k] + self.right[k]) // <span class="hljs-number">2</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push_up</span>(<span class="hljs-params">self, k</span>):<br>        self.<span class="hljs-built_in">max</span>[k] = <span class="hljs-built_in">max</span>(self.<span class="hljs-built_in">max</span>[ls(k)], self.<span class="hljs-built_in">max</span>[rs(k)])<br>        self.<span class="hljs-built_in">min</span>[k] = <span class="hljs-built_in">min</span>(self.<span class="hljs-built_in">min</span>[ls(k)], self.<span class="hljs-built_in">min</span>[rs(k)])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">build</span>(<span class="hljs-params">self, k, l, r</span>):<br>        self.left[k], self.right[k] = l, r<br><br>        <span class="hljs-keyword">if</span> l == r:<br>            self.<span class="hljs-built_in">max</span>[k] = self.array[l]<br>            self.<span class="hljs-built_in">min</span>[k] = self.array[l]<br>        <span class="hljs-keyword">else</span>:<br>            m = self.m(k)<br><br>            self.build(ls(k), l, m)<br>            self.build(rs(k), m + <span class="hljs-number">1</span>, r)<br>            self.push_up(k)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_query</span>(<span class="hljs-params">self, k, a, b</span>):<br>        <span class="hljs-keyword">if</span> a &lt;= self.left[k] <span class="hljs-keyword">and</span> self.right[k] &lt;= b:<br>            <span class="hljs-keyword">return</span> self.<span class="hljs-built_in">max</span>[k], self.<span class="hljs-built_in">min</span>[k]<br><br>        M, m = <span class="hljs-number">0</span>, <span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;inf&#x27;</span>)<br><br>        <span class="hljs-keyword">if</span> a &lt;= self.m(k):<br>            _M, _m = self._query(ls(k), a, b)<br>            M = <span class="hljs-built_in">max</span>(M, _M)<br>            m = <span class="hljs-built_in">min</span>(m, _m)<br>        <span class="hljs-keyword">if</span> self.m(k) &lt; b:<br>            _M, _m = self._query(rs(k), a, b)<br>            M = <span class="hljs-built_in">max</span>(M, _M)<br>            m = <span class="hljs-built_in">min</span>(m, _m)<br><br>        <span class="hljs-keyword">return</span> M, m<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">self, a, b</span>):<br>        <span class="hljs-keyword">return</span> self._query(<span class="hljs-number">1</span>, a, b)<br></code></pre></td></tr></table></figure>
<h5 id="公约数">公约数</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GCDSegmentTree</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, array</span>):  <span class="hljs-comment"># element index starts from 0</span><br>        <span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> gcd<br><br>        self.gcd = gcd<br><br>        self.n = <span class="hljs-built_in">len</span>(array)<br>        size = <span class="hljs-number">4</span> * self.n<br><br>        self.array = [<span class="hljs-number">0</span>] + array<br><br>        self.left, self.right = [<span class="hljs-number">0</span>] * size, [<span class="hljs-number">0</span>] * size<br>        self.value, self.tag = [<span class="hljs-number">0</span>] * size, [<span class="hljs-number">0</span>] * size<br><br>        self.build(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, self.n)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">m</span>(<span class="hljs-params">self, k</span>):<br>        <span class="hljs-keyword">return</span> (self.left[k] + self.right[k]) // <span class="hljs-number">2</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">length</span>(<span class="hljs-params">self, k</span>):<br>        <span class="hljs-keyword">return</span> self.right[k] - self.left[k] + <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push_up</span>(<span class="hljs-params">self, k</span>):<br>        self.value[k] = self.gcd(self.value[ls(k)], self.value[rs(k)])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">build</span>(<span class="hljs-params">self, k, l, r</span>):<br>        self.left[k], self.right[k] = l, r<br><br>        <span class="hljs-keyword">if</span> l == r:<br>            self.value[k] = self.array[l]<br>        <span class="hljs-keyword">else</span>:<br>            m = self.m(k)<br><br>            self.build(ls(k), l, m)<br>            self.build(rs(k), m + <span class="hljs-number">1</span>, r)<br>            self.push_up(k)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_query</span>(<span class="hljs-params">self, k, a, b</span>):<br>        <span class="hljs-keyword">if</span> a &lt;= self.left[k] <span class="hljs-keyword">and</span> self.right[k] &lt;= b:<br>            <span class="hljs-keyword">return</span> self.value[k]<br><br>        res = <span class="hljs-number">0</span><br><br>        m = self.m(k)<br>        <span class="hljs-keyword">if</span> a &lt;= m:<br>            res = self.gcd(res, self._query(ls(k), a, b))<br>        <span class="hljs-keyword">if</span> m &lt; b:<br>            res = self.gcd(res, self._query(rs(k), a, b))<br><br>        <span class="hljs-keyword">return</span> res<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">self, a, b</span>):<br>        <span class="hljs-keyword">return</span> self._query(<span class="hljs-number">1</span>, a, b)<br></code></pre></td></tr></table></figure>
<h5 id="区间加，区间乘，查询区间和">区间加，区间乘，查询区间和</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ModCalculation</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, mod=<span class="hljs-number">0</span></span>):<br>        self.mod = mod<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_mod</span>(<span class="hljs-params">self, a</span>):<br>        <span class="hljs-keyword">return</span> a % self.mod <span class="hljs-keyword">if</span> self.mod <span class="hljs-keyword">else</span> a<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">self, a, b</span>):<br>        <span class="hljs-keyword">return</span> (a + b) % self.mod <span class="hljs-keyword">if</span> self.mod <span class="hljs-keyword">else</span> a + b<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params">self, iterable</span>):<br>        s = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> iterable:<br>            s = self.add(s, i)<br>        <span class="hljs-keyword">return</span> s<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">mul</span>(<span class="hljs-params">self, a, b</span>):<br>        <span class="hljs-keyword">return</span> (a * b) % self.mod <span class="hljs-keyword">if</span> self.mod <span class="hljs-keyword">else</span> a * b<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">power</span>(<span class="hljs-params">self, a, n</span>):<br>        res = <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">while</span> n:<br>            res = self.mul(res, a)<br><br>        <span class="hljs-keyword">return</span> res<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">quick_power</span>(<span class="hljs-params">self, a, n</span>):<br>        res = <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">while</span> n:<br>            <span class="hljs-keyword">if</span> n &amp; <span class="hljs-number">1</span>:<br>                res = self.mul(res, a)<br><br>            a = self.mul(a, a)<br>            n &gt;&gt;= <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">return</span> res<br><br><br>ring = ModCalculation(<span class="hljs-number">571373</span>)<br><br>ls = <span class="hljs-keyword">lambda</span> k: <span class="hljs-number">2</span> * k<br>rs = <span class="hljs-keyword">lambda</span> k: <span class="hljs-number">2</span> * k + <span class="hljs-number">1</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SegmentTree</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, array</span>):  <span class="hljs-comment"># element index starts from 0</span><br>        self.n = <span class="hljs-built_in">len</span>(array)<br>        self.size = <span class="hljs-number">4</span> * self.n<br><br>        self.array = [<span class="hljs-number">0</span>] + array<br><br>        self.left, self.right = [<span class="hljs-number">0</span>] * self.size, [<span class="hljs-number">0</span>] * self.size<br>        self.value = [<span class="hljs-number">0</span>] * self.size<br><br>        self.add_tag = [<span class="hljs-number">0</span>] * self.size<br>        self.mul_tag = [<span class="hljs-number">1</span>] * self.size<br><br>        self.build(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, self.n)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">m</span>(<span class="hljs-params">self, k</span>):<br>        <span class="hljs-keyword">return</span> (self.left[k] + self.right[k]) // <span class="hljs-number">2</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">length</span>(<span class="hljs-params">self, k</span>):<br>        <span class="hljs-keyword">return</span> self.right[k] - self.left[k] + <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_update</span>(<span class="hljs-params">self, cmd</span>):<br>        self.update = self.update_add <span class="hljs-keyword">if</span> cmd == <span class="hljs-number">2</span> <span class="hljs-keyword">else</span> self.update_mul<br><br>    <span class="hljs-comment"># def update(self, k, delt):</span><br>    <span class="hljs-comment">#     # self.tag[k] += delt</span><br>    <span class="hljs-comment">#     # self.value[k] += delt * self.length(k)</span><br>    <span class="hljs-comment">#     pass</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_add</span>(<span class="hljs-params">self, k, delt</span>):<br>        self.add_tag[k] = ring.add(self.add_tag[k], delt)<br>        self.value[k] = ring.add(self.value[k], ring.mul(self.length(k), delt))<br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_mul</span>(<span class="hljs-params">self, k, delt</span>):<br>        self.add_tag[k] = ring.mul(self.add_tag[k], delt)<br>        self.mul_tag[k] = ring.mul(self.mul_tag[k], delt)<br>        self.value[k] = ring.mul(self.value[k], delt)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push_up</span>(<span class="hljs-params">self, k</span>):<br>        self.value[k] = ring.add(self.value[ls(k)], self.value[rs(k)])<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push_down</span>(<span class="hljs-params">self, k</span>):<br>        add_delt = self.add_tag[k]<br>        mul_delt = self.mul_tag[k]<br><br>        self.update_mul(ls(k), mul_delt), self.update_mul(rs(k), mul_delt)<br>        self.update_add(ls(k), add_delt), self.update_add(rs(k), add_delt)<br><br>        self.add_tag[k] = <span class="hljs-number">0</span><br>        self.mul_tag[k] = <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">build</span>(<span class="hljs-params">self, k, l, r</span>):<br>        self.left[k], self.right[k] = l, r<br><br>        <span class="hljs-keyword">if</span> l == r:<br>            self.value[k] = self.array[l]<br>        <span class="hljs-keyword">else</span>:<br>            m = self.m(k)<br><br>            self.build(ls(k), l, m)<br>            self.build(rs(k), m + <span class="hljs-number">1</span>, r)<br>            self.push_up(k)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_modify</span>(<span class="hljs-params">self, k, a, b, delt</span>):<br>        <span class="hljs-keyword">if</span> a &lt;= self.left[k] <span class="hljs-keyword">and</span> self.right[k] &lt;= b:<br>            self.update(k, delt)<br>        <span class="hljs-keyword">else</span>:<br>            self.push_down(k)<br>            m = self.m(k)<br><br>            <span class="hljs-keyword">if</span> a &lt;= m:<br>                self._modify(ls(k), a, b, delt)<br>            <span class="hljs-keyword">if</span> b &gt; m:<br>                self._modify(rs(k), a, b, delt)<br>            self.push_up(k)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_query</span>(<span class="hljs-params">self, k, a, b</span>):<br>        res = <span class="hljs-number">0</span><br><br>        <span class="hljs-keyword">if</span> a &lt;= self.left[k] <span class="hljs-keyword">and</span> self.right[k] &lt;= b:<br>            <span class="hljs-keyword">return</span> self.value[k]<br><br>        self.push_down(k)<br>        m = self.m(k)<br><br>        <span class="hljs-keyword">if</span> a &lt;= m:<br>            res = ring.add(res, self._query(ls(k), a, b))<br>        <span class="hljs-keyword">if</span> m &lt; b:<br>            res = ring.add(res, self._query(rs(k), a, b))<br><br>        <span class="hljs-keyword">return</span> res<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">modify</span>(<span class="hljs-params">self, a, b, delt</span>):<br>        self._modify(<span class="hljs-number">1</span>, a, b, delt)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">self, a, b</span>):<br>        <span class="hljs-keyword">return</span> self._query(<span class="hljs-number">1</span>, a, b)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    n, m, _ = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    array = [<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">input</span>().split()]<br><br>    tree = SegmentTree(array)<br><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>        <span class="hljs-built_in">iter</span> = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>        cmd, a, b = <span class="hljs-built_in">next</span>(<span class="hljs-built_in">iter</span>), <span class="hljs-built_in">next</span>(<span class="hljs-built_in">iter</span>), <span class="hljs-built_in">next</span>(<span class="hljs-built_in">iter</span>)<br><br>        <span class="hljs-keyword">if</span> cmd == <span class="hljs-number">3</span>:<br>            <span class="hljs-built_in">print</span>(tree.query(a, b))<br>        <span class="hljs-keyword">else</span>:<br>            tree.set_update(cmd)<br>            k = <span class="hljs-built_in">next</span>(<span class="hljs-built_in">iter</span>)<br><br>            tree.modify(a, b, k)<br></code></pre></td></tr></table></figure>
<h3 id="树堆">树堆</h3>
<h4 id="单点修改-2">单点修改</h4>
<h5 id="结构">结构</h5>
<p>链式结构，每个节点有权值value和随机分配的键值key。满足按权构成二叉搜索树同时按键构成最小堆的树堆存在且唯一，其效率期望符合平衡树</p>
<p>为了按秩访问节点，根据treap性质为节点增加size属性，同时定义push_up()方法在更新树后更新size属性</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">get_size = <span class="hljs-keyword">lambda</span> p: p.size <span class="hljs-keyword">if</span> p <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">node</span>:<br>    <span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> random<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, value</span>):<br>        self.value = value<br>        self.key = node.random()<br>        self.left, self.right = <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br>        self.size = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push_up</span>(<span class="hljs-params">self</span>):<br>        self.size = <span class="hljs-number">1</span> + get_size(self.left) + get_size(self.right)<br></code></pre></td></tr></table></figure>
<h5 id="基本操作-2">基本操作</h5>
<p>分裂与合并的组合可以实现大部分树的操作</p>
<h6 id="按值分裂">按值分裂</h6>
<p>将一棵treap分裂为一棵全部值小于等于目标值的treap和一棵全部值大于目标值的treap。</p>
<p>对于非空节点p，当p.value &lt;= x时，p及p的左子树全部值小于等于x，此时将p的右子树分裂为全部值小于等于目标值的l和全部值大于目标值的r，r就是全部值大于x的treap，因为p是treap，所以树堆l根节点的值与键都大于p，将l插在p的右子树后整体依然构成treap。p.value &gt; x时同理。在递归过程中每次更新p的左右子树后更新其size从而保证size值正确</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">split</span>(<span class="hljs-params">p, x</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> p:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">if</span> p.value &lt;= x:<br>        l, r = split(p.right, x)<br>        l, p.right = p, l<br>    <span class="hljs-keyword">else</span>:<br>        l, r = split(p.left, x)<br>        r, p.left = p, r<br>    p.push_up()<br>    <span class="hljs-keyword">return</span> l, r<br></code></pre></td></tr></table></figure>
<h6 id="合并">合并</h6>
<p>将非空树堆l，r(max(l) &lt;= min®)合并</p>
<p>当l.key &lt;= r.key时，将l右子树与r合并，新树堆的值与键都大于l，故将其插入l右子树出l仍为treap，l.key &gt; r.key时同理。在递归过程中每次更新p的左右子树后更新其size从而保证size值正确</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">merge</span>(<span class="hljs-params">l, r</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> l <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> r:<br>        <span class="hljs-keyword">return</span> l <span class="hljs-keyword">or</span> r<br>    <span class="hljs-keyword">if</span> l.key &lt;= r.key:<br>        l.right, p = merge(l.right, r), l<br>    <span class="hljs-keyword">else</span>:<br>        r.left, p = merge(l, r.left), r<br>    p.push_up()<br>    <span class="hljs-keyword">return</span> p<br></code></pre></td></tr></table></figure>
<h5 id="功能架构">功能架构</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">treap</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.root = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">insert</span>(<span class="hljs-params">self, x</span>):<br>        l, r = split(self.root, x - <span class="hljs-number">1</span>)<br>        l = merge(l, node(x))<br>        self.root = merge(l, r)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">remove</span>(<span class="hljs-params">self, x</span>):<br>        l, r = split(self.root, x - <span class="hljs-number">1</span>)<br>        l1, r1 = split(r, x)<br>        l1 = merge(l1.left, l1.right)<br>        r = merge(l1, r1)<br>        self.root = merge(l, r)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rank</span>(<span class="hljs-params">self, x</span>):<br>        l, r = split(self.root, x - <span class="hljs-number">1</span>)<br>        size = get_size(l)<br>        self.root = merge(l, r)<br>        <span class="hljs-keyword">return</span> size + <span class="hljs-number">1</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">value</span>(<span class="hljs-params">self, k</span>):<br>        p = self.root<br>        <span class="hljs-keyword">while</span> p:<br>            rk = get_size(p.left) + <span class="hljs-number">1</span><br>            <span class="hljs-keyword">if</span> k &lt; rk:<br>                p = p.left<br>            <span class="hljs-keyword">elif</span> k &gt; rk:<br>                k -= rk<br>                p = p.right<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> p.value<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">lower</span>(<span class="hljs-params">self, x</span>):<br>        p, M = self.root, -<span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>)<br>        <span class="hljs-keyword">while</span> p:<br>            <span class="hljs-keyword">if</span> p.value &lt; x:<br>                M = <span class="hljs-built_in">max</span>(M, p.value)<br>                p = p.right<br>            <span class="hljs-keyword">else</span>:<br>                p = p.left<br>        <span class="hljs-keyword">return</span> M<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">upper</span>(<span class="hljs-params">self, x</span>):<br>        p, m = self.root, <span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>)<br>        <span class="hljs-keyword">while</span> p:<br>            <span class="hljs-keyword">if</span> p.value &gt; x:<br>                m = <span class="hljs-built_in">min</span>(m, p.value)<br>                p = p.left<br>            <span class="hljs-keyword">else</span>:<br>                p = p.right<br>        <span class="hljs-keyword">return</span> m<br></code></pre></td></tr></table></figure>
<h4 id="区间翻转">区间翻转</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> random<br>get_size = <span class="hljs-keyword">lambda</span> p: p.size <span class="hljs-keyword">if</span> p <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">node</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x</span>):<br>        self.value = x<br>        self.key = random()<br>        self.left, self.right = <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br>        self.size = <span class="hljs-number">1</span><br>        self.<span class="hljs-built_in">reversed</span> = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push_up</span>(<span class="hljs-params">self</span>):<br>        self.size = <span class="hljs-number">1</span> + get_size(self.left) + get_size(self.right)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push_down</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.<span class="hljs-built_in">reversed</span>:<br>            <span class="hljs-keyword">return</span><br>        <span class="hljs-keyword">if</span> self.left:<br>            self.left.<span class="hljs-built_in">reversed</span> ^= <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">if</span> self.right:<br>            self.right.<span class="hljs-built_in">reversed</span> ^= <span class="hljs-literal">True</span><br>        self.<span class="hljs-built_in">reversed</span> = <span class="hljs-literal">False</span><br>        self.left, self.right = self.right, self.left<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">split</span>(<span class="hljs-params">p, k</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> p:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br>    p.push_down()<br>    rk = <span class="hljs-number">1</span> + get_size(p.left)<br>    <span class="hljs-keyword">if</span> rk &lt;= k:<br>        l, r = split(p.right, k - rk)<br>        l, p.right = p, l<br>    <span class="hljs-keyword">else</span>:<br>        l, r = split(p.left, k)<br>        r, p.left = p, r<br>    p.push_up()<br>    <span class="hljs-keyword">return</span> l, r<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">merge</span>(<span class="hljs-params">l, r</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> l <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> r:<br>        <span class="hljs-keyword">return</span> l <span class="hljs-keyword">or</span> r<br>    l.push_down()<br>    r.push_down()<br>    <span class="hljs-keyword">if</span> l.key &lt;= r.key:<br>        p, l.right = l, merge(l.right, r)<br>    <span class="hljs-keyword">else</span>:<br>        p, r.left = r, merge(l, r.left)<br>    p.push_up()<br>    <span class="hljs-keyword">return</span> p<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">treap</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.root = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">insert</span>(<span class="hljs-params">self, x</span>):<br>        self.root = merge(self.root, node(x))<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reverse</span>(<span class="hljs-params">self, a, b</span>):<br>        l, m = split(self.root, a - <span class="hljs-number">1</span>)<br>        m, r = split(m, b - a + <span class="hljs-number">1</span>)<br>        m.<span class="hljs-built_in">reversed</span> ^= <span class="hljs-literal">True</span><br>        r = merge(m, r)<br>        self.root = merge(l, r)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">list</span>(<span class="hljs-params">self</span>):<br>        l = []<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">p</span>):<br>            p.push_down()<br>            <span class="hljs-keyword">if</span> p.left:<br>                dfs(p.left)<br>            l.append(p.value)<br>            <span class="hljs-keyword">if</span> p.right:<br>                dfs(p.right)<br>        dfs(self.root)<br>        <span class="hljs-keyword">return</span> l<br></code></pre></td></tr></table></figure>
<h4 id="区间查改">区间查改</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> random<br>get_size = <span class="hljs-keyword">lambda</span> p: p.size <span class="hljs-keyword">if</span> p <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br>get_sum = <span class="hljs-keyword">lambda</span> p: p.<span class="hljs-built_in">sum</span> <span class="hljs-keyword">if</span> p <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">node</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, value</span>):<br>        self.<span class="hljs-built_in">sum</span> = self.value = value<br>        self.key = random()<br>        self.size = <span class="hljs-number">1</span><br>        self.left = self.right = <span class="hljs-literal">None</span><br>        self.tag = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push_up</span>(<span class="hljs-params">self</span>):<br>        self.<span class="hljs-built_in">sum</span> = self.value + get_sum(self.left) + get_sum(self.right)<br>        self.size = <span class="hljs-number">1</span> + get_size(self.left) + get_size(self.right)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push_down</span>(<span class="hljs-params">self</span>):<br>        cover(self.left, self.tag)<br>        cover(self.right, self.tag)<br>        self.tag = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cover</span>(<span class="hljs-params">p, tag</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> p:<br>        <span class="hljs-keyword">return</span><br>    p.tag += tag<br>    p.value += tag<br>    p.<span class="hljs-built_in">sum</span> += tag * get_size(p)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">split</span>(<span class="hljs-params">p, k</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> p:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span><br>    p.push_down()<br>    rk = <span class="hljs-number">1</span> + get_size(p.left)<br>    <span class="hljs-keyword">if</span> rk &lt;= k:<br>        l, r = split(p.right, k - rk)<br>        l, p.right = p, l<br>    <span class="hljs-keyword">else</span>:<br>        l, r = split(p.left, k)<br>        r, p.left = p, r<br>    p.push_up()<br>    <span class="hljs-keyword">return</span> l, r<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">merge</span>(<span class="hljs-params">l, r</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> l <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> r:<br>        <span class="hljs-keyword">return</span> l <span class="hljs-keyword">or</span> r<br>    l.push_down()<br>    r.push_down()<br>    <span class="hljs-keyword">if</span> l.key &lt;= r.key:<br>        p, l.right = l, merge(l.right, r)<br>    <span class="hljs-keyword">else</span>:<br>        p, r.left = r, merge(l, r.left)<br>    p.push_up()<br>    <span class="hljs-keyword">return</span> p<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">treap</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.root = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">insert</span>(<span class="hljs-params">self, value</span>):<br>        self.root = merge(self.root, node(value))<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">modify</span>(<span class="hljs-params">self, a, b, tag</span>):<br>        l, m = split(self.root, a - <span class="hljs-number">1</span>)<br>        m, r = split(m, b - a + <span class="hljs-number">1</span>)<br>        cover(m, tag)<br>        r = merge(m, r)<br>        self.root = merge(l, r)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">self, a, b</span>):<br>        l, m = split(self.root, a - <span class="hljs-number">1</span>)<br>        m, r = split(m, b - a + <span class="hljs-number">1</span>)<br>        s = m.<span class="hljs-built_in">sum</span><br>        r = merge(m, r)<br>        self.root = merge(l, r)<br>        <span class="hljs-keyword">return</span> s<br></code></pre></td></tr></table></figure>
<h1>算法</h1>
<h2 id="二分查找">二分查找</h2>
<p>对于一个分隔为两部分的列表不妨设前一部分为真，找到最后一个使题设为真的下标</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">bound</span>(<span class="hljs-params">true, l, r</span>):      <span class="hljs-comment"># last number makes true in [l, r)</span><br>    <span class="hljs-keyword">if</span> r - l == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> true(l):<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>           <span class="hljs-comment"># no number makes true</span><br>    <br>    <span class="hljs-keyword">while</span> r - l &gt; <span class="hljs-number">1</span>:<br>        m = (l + r) // <span class="hljs-number">2</span><br><br>        <span class="hljs-keyword">if</span> true(m):<br>            l = m<br>        <span class="hljs-keyword">else</span>:<br>            r = m<br><br>    <span class="hljs-keyword">return</span> l<br></code></pre></td></tr></table></figure>
<h2 id="滑动窗口">滑动窗口</h2>
<p>区间数据满足二分属性，不妨设满足题意部分为真</p>
<h3 id="最长">最长</h3>
<p>连续数据增长趋近为假，求条件为真最长连续子区间长度</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Window</span>:<br>    <span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.queue = self.deque()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.queue)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push</span>(<span class="hljs-params">self, x</span>):<br>        self.queue.append(x)<br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pop</span>(<span class="hljs-params">self</span>):<br>        self.queue.popleft()<br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">true</span>(<span class="hljs-params">self</span>):<br>        q_set = <span class="hljs-built_in">set</span>(self.queue)<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self) == <span class="hljs-built_in">len</span>(q_set)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">lengthOfLongestSubstring</span>(<span class="hljs-params">self, s</span>):<br>        window = Window()<br><br>        M = <span class="hljs-number">0</span><br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s:<br>            window.push(i)<br><br>            <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> window.true():<br>                window.pop()<br><br>            M = <span class="hljs-built_in">max</span>(M, <span class="hljs-built_in">len</span>(window))<br><br>        <span class="hljs-keyword">return</span> M<br></code></pre></td></tr></table></figure>
<h3 id="最短">最短</h3>
<p>连续数据增长趋近为真，求条件为真最短连续子区间长度</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Window</span>:<br>    <span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.queue = self.deque()<br><br>        self.<span class="hljs-built_in">sum</span> = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.queue)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push</span>(<span class="hljs-params">self, x</span>):<br>        self.queue.append(x)<br><br>        self.<span class="hljs-built_in">sum</span> += x<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pop</span>(<span class="hljs-params">self</span>):<br>        self.<span class="hljs-built_in">sum</span> -= self.queue.popleft()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">true</span>(<span class="hljs-params">self, target</span>):<br>        <span class="hljs-keyword">return</span> self.<span class="hljs-built_in">sum</span> &gt;= target<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">minSubArrayLen</span>(<span class="hljs-params">self, target, nums</span>):<br>        window = Window()<br><br>        m = <span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;inf&#x27;</span>)<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> nums:<br>            window.push(i)<br>            <br>            <span class="hljs-keyword">while</span> window.true(target):<br>                m = <span class="hljs-built_in">min</span>(m, <span class="hljs-built_in">len</span>(window))<br>                <br>                window.pop()<br><br>        <span class="hljs-keyword">return</span> m <span class="hljs-keyword">if</span> m &lt; <span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;inf&#x27;</span>) <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<h3 id="计数">计数</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowCounter</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, left</span>):           <span class="hljs-comment"># 窗口最左端初始位置</span><br>        self.left = left<br>        self.right = left - <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.right - self.left + <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push</span>(<span class="hljs-params">self</span>):<br>        self.right += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pop</span>(<span class="hljs-params">self</span>):<br>        self.left += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">true</span>(<span class="hljs-params">self</span>):<br><br>        <span class="hljs-keyword">return</span><br></code></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PrefixArea</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, matrix</span>):  <span class="hljs-comment"># matrix extend 0</span><br>        n = <span class="hljs-built_in">len</span>(matrix)<br>        m = <span class="hljs-built_in">len</span>(matrix[<span class="hljs-number">0</span>])<br><br>        self.area = [[<span class="hljs-number">0</span>] * m <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n):<br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, m):<br>                self.area[i][j] = matrix[i][j] + self.two_area(i - <span class="hljs-number">1</span>, j - <span class="hljs-number">1</span>, i, j)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">two_area</span>(<span class="hljs-params">self, x1, y1, x2, y2</span>):  <span class="hljs-comment"># x1 &lt;= x2, y1 &lt;= y2</span><br>        <span class="hljs-keyword">return</span> self.area[x1][y2] + self.area[x2][y1] - self.area[x1][y1]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">self, x1, y1, x2, y2</span>):<br>        <span class="hljs-keyword">return</span> self.area[x2][y2] - self.two_area(x1 - <span class="hljs-number">1</span>, y1 - <span class="hljs-number">1</span>, x2, y2)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowCounter</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, left, matrix, up, down</span>):<br>        self.left = left<br>        self.right = left - <span class="hljs-number">1</span><br><br>        self.matrix = matrix<br><br>        self.up = up<br>        self.down = down<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.right - self.left + <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">push</span>(<span class="hljs-params">self</span>):<br>        self.right += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pop</span>(<span class="hljs-params">self</span>):<br>        self.left += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">true</span>(<span class="hljs-params">self, prefix_area, limit</span>):<br>        <span class="hljs-built_in">sum</span> = prefix_area.query(self.up, self.left, self.down, self.right)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span> &lt;= limit<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extend0_matrix_input</span>(<span class="hljs-params">n, m</span>):<br>    <span class="hljs-keyword">return</span> [[<span class="hljs-number">0</span>] * (m + <span class="hljs-number">1</span>)] + [[<span class="hljs-number">0</span>] + [<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">input</span>().split()] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    n, m, limit = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    matrix = extend0_matrix_input(n, m)<br><br>    prefix_area = PrefixArea(matrix)<br>    cnt = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">for</span> up <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> down <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(up, n + <span class="hljs-number">1</span>):  <span class="hljs-comment"># left initial</span><br>            window_counter = WindowCounter(<span class="hljs-number">1</span>, matrix, up, down)<br><br>            <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>                window_counter.push()<br><br>                <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> window_counter.true(prefix_area, limit):<br>                    window_counter.pop()<br><br>                cnt += <span class="hljs-built_in">len</span>(window_counter)<br><br>    <span class="hljs-built_in">print</span>(cnt)<br></code></pre></td></tr></table></figure>
<h2 id="dp">dp</h2>
<h3 id="线性">线性</h3>
<h4 id="最长公共子序列">最长公共子序列</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">a, b = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>A, B = <span class="hljs-string">&quot; &quot;</span> + <span class="hljs-built_in">input</span>(), <span class="hljs-string">&quot; &quot;</span> + <span class="hljs-built_in">input</span>()<br>dp = [[<span class="hljs-number">0</span>] * (b + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(a + <span class="hljs-number">1</span>)]      <span class="hljs-comment"># A from 1 to i B from 1 to j sub max</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, a + <span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, b + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> A[i] == B[j]:<br>            dp[i][j] = dp[i - <span class="hljs-number">1</span>][j - <span class="hljs-number">1</span>] + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            dp[i][j] = <span class="hljs-built_in">max</span>(dp[i - <span class="hljs-number">1</span>][j], dp[i][j - <span class="hljs-number">1</span>])<br><span class="hljs-built_in">print</span>(dp[a][b])<br></code></pre></td></tr></table></figure>
<h4 id="LIS">LIS</h4>
<h5 id="dp-2">dp</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">LIS</span>(<span class="hljs-params">arr</span>):<br>    n = <span class="hljs-built_in">len</span>(arr)<br>    arr.insert(<span class="hljs-number">0</span>, -<span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>))<br>    dp = [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br>    M = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i):<br>            <span class="hljs-keyword">if</span> arr[j] &lt; arr[i]:<br>                dp[i] = <span class="hljs-built_in">max</span>(dp[i], dp[j] + <span class="hljs-number">1</span>)<br>                M = <span class="hljs-built_in">max</span>(M, dp[i])<br>    ans = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> dp[i] == M:<br>            ans.append(arr[i])<br>            M -= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> M == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">return</span> ans[-<span class="hljs-number">1</span>: : -<span class="hljs-number">1</span>]<br></code></pre></td></tr></table></figure>
<h5 id="二分">二分</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">LIS</span>(<span class="hljs-params">arr</span>):<br>    n, w = <span class="hljs-built_in">len</span>(arr), [-<span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>)] + arr<br>    min_tail, size = [-<span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>)] + [<span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>)] * n, [<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>)<br>    find = <span class="hljs-keyword">lambda</span> x: bound(<span class="hljs-keyword">lambda</span> i: min_tail[i] &lt; x, <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>))<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>        j = find(w[i])<br>        size[i] = j + <span class="hljs-number">1</span><br>        min_tail[j + <span class="hljs-number">1</span>] = <span class="hljs-built_in">min</span>(min_tail[j + <span class="hljs-number">1</span>], w[i])<br>    M, ans = <span class="hljs-built_in">max</span>(size), []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> size[i] == M:<br>            ans.append(w[i])<br>            M -= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> M == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">return</span> ans[n: : -<span class="hljs-number">1</span>]<br></code></pre></td></tr></table></figure>
<h3 id="背包">背包</h3>
<h4 id="01">01</h4>
<h5 id="递归">递归</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> lru_cache<br>n, k = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>v, w = [<span class="hljs-number">0</span>], [<span class="hljs-number">0</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    vi, wi = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    v.append(vi)<br>    w.append(wi)<br><span class="hljs-meta">@lru_cache()</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">max_w</span>(<span class="hljs-params">n, k</span>):<br>    <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> k == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    M = max_w(n - <span class="hljs-number">1</span>, k)<br>    <span class="hljs-keyword">if</span> k &gt;= v[n]:<br>        M = <span class="hljs-built_in">max</span>(M, <br>                max_w(n - <span class="hljs-number">1</span>, k - v[n]) + w[n])<br>    <span class="hljs-keyword">return</span> M<br><span class="hljs-built_in">print</span>(max_w(n, k))<br></code></pre></td></tr></table></figure>
<h5 id="dp-3">dp</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">n, k = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>v, w = [<span class="hljs-number">0</span>], [<span class="hljs-number">0</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    vi, wi = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    v.append(vi)<br>    w.append(wi)<br>dp = [[<span class="hljs-number">0</span>] * (k + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, k + <span class="hljs-number">1</span>):<br>        dp[i][j] = dp[i - <span class="hljs-number">1</span>][j]<br>        <span class="hljs-keyword">if</span> j &gt;= v[i]:<br>            dp[i][j] = <span class="hljs-built_in">max</span>(dp[i][j],<br>                           dp[i - <span class="hljs-number">1</span>][j - v[i]] + w[i])<br><span class="hljs-built_in">print</span>(dp[n][k])<br></code></pre></td></tr></table></figure>
<h4 id="完全">完全</h4>
<h5 id="递归-2">递归</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> lru_cache<br>n, k = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>v, w = [<span class="hljs-number">0</span>], [<span class="hljs-number">0</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    vi, wi = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    v.append(vi)<br>    w.append(wi)<br><span class="hljs-meta">@lru_cache()</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">max_w</span>(<span class="hljs-params">n, k</span>):<br>    <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> k == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    M = max_w(n - <span class="hljs-number">1</span>, k)<br>    <span class="hljs-keyword">if</span> k &gt;= v[n]:<br>        M = <span class="hljs-built_in">max</span>(M,<br>                max_w(n, k - v[n]) + w[n])<br>    <span class="hljs-keyword">return</span> M<br><span class="hljs-built_in">print</span>(max_w(n, k))<br></code></pre></td></tr></table></figure>
<h5 id="dp-4">dp</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">n, k = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>v, w = [<span class="hljs-number">0</span>], [<span class="hljs-number">0</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    vi, wi = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    v.append(vi)<br>    w.append(wi)<br>dp = [[<span class="hljs-number">0</span>] * (k + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, k + <span class="hljs-number">1</span>):<br>        dp[i][j] = dp[i - <span class="hljs-number">1</span>][j]<br>        <span class="hljs-keyword">if</span> j &gt;= v[i]:<br>            dp[i][j] = <span class="hljs-built_in">max</span>(dp[i][j],<br>                           dp[i][j - v[i]] + w[i])<br><span class="hljs-built_in">print</span>(dp[n][k])<br></code></pre></td></tr></table></figure>
<h5 id="整数划分">整数划分</h5>
<h6 id="递归-3">递归</h6>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> lru_cache<br>n, mod = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>()), <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span>) + <span class="hljs-number">7</span><br><span class="hljs-meta">@lru_cache()</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">count</span>(<span class="hljs-params">n, m</span>):<br>    <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> m == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    cnt = count(n, m - <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">if</span> n &gt;= m:<br>        cnt = (cnt + count(n - m, m)) % mod<br>    <span class="hljs-keyword">return</span> cnt<br><span class="hljs-built_in">print</span>(count(n, n))<br></code></pre></td></tr></table></figure>
<h6 id="dp-5">dp</h6>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">n, mod = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>()), <span class="hljs-built_in">int</span>(<span class="hljs-number">1e9</span>) + <span class="hljs-number">7</span><br>dp = [[<span class="hljs-number">1</span>] * (n + <span class="hljs-number">1</span>)] + [[<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>        dp[i][j] = dp[i][j - <span class="hljs-number">1</span>]<br>        <span class="hljs-keyword">if</span> i &gt;= j:<br>            dp[i][j] = (dp[i][j] + dp[i - j][j]) % mod<br><span class="hljs-built_in">print</span>(dp[n][n])<br></code></pre></td></tr></table></figure>
<h4 id="多重">多重</h4>
<h5 id="朴素">朴素</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">n, k = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>v, w, s = [<span class="hljs-number">0</span>], [<span class="hljs-number">0</span>], [<span class="hljs-number">0</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    vi, wi, si = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    v.append(vi)<br>    w.append(wi)<br>    s.append(si)<br>dp = [[<span class="hljs-number">0</span>] * (k + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, k + <span class="hljs-number">1</span>):<br>        m = <span class="hljs-built_in">min</span>(s[i], j // v[i])<br>        <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m + <span class="hljs-number">1</span>):<br>            dp[i][j] = <span class="hljs-built_in">max</span>(dp[i][j],<br>                           dp[i - <span class="hljs-number">1</span>][j - v[i] * l] + w[i] * l)<br><span class="hljs-built_in">print</span>(dp[n][k])<br></code></pre></td></tr></table></figure>
<h5 id="二进制优化">二进制优化</h5>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> log2<br>n, k = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>v, w = [<span class="hljs-number">0</span>], [<span class="hljs-number">0</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    vi, wi, si = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    ki = <span class="hljs-built_in">int</span>(log2(si + <span class="hljs-number">1</span>)) - <span class="hljs-number">1</span><br>    v.append(vi)<br>    w.append(wi)<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, ki + <span class="hljs-number">1</span>):<br>        v.append(v[-<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">1</span>)<br>        w.append(w[-<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">1</span>)<br>    m = si + <span class="hljs-number">1</span> - (<span class="hljs-number">1</span> &lt;&lt; ki + <span class="hljs-number">1</span>)<br>    v.append(vi * m)<br>    w.append(wi * m)<br>n = <span class="hljs-built_in">len</span>(v) - <span class="hljs-number">1</span><br>dp = [[<span class="hljs-number">0</span>] * (k + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, k + <span class="hljs-number">1</span>):<br>        dp[i][j] = dp[i - <span class="hljs-number">1</span>][j]<br>        <span class="hljs-keyword">if</span> j &gt;= v[i]:<br>            dp[i][j] = <span class="hljs-built_in">max</span>(dp[i][j],<br>                           dp[i - <span class="hljs-number">1</span>][j - v[i]] + w[i])<br><span class="hljs-built_in">print</span>(dp[n][k])<br></code></pre></td></tr></table></figure>
<h4 id="分组">分组</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">n, k = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>vw = [[(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)]]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    vw.append([(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)])<br>    m = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m):<br>        vw[i].append(<span class="hljs-built_in">tuple</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())))<br>dp = [[<span class="hljs-number">0</span>] * (k + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, k + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> v, w <span class="hljs-keyword">in</span> vw[i]:<br>            <span class="hljs-keyword">if</span> j &gt;= v:<br>                dp[i][j] = <span class="hljs-built_in">max</span>(dp[i][j],<br>                               dp[i - <span class="hljs-number">1</span>][j - v] + w)<br><span class="hljs-built_in">print</span>(dp[n][k])<br></code></pre></td></tr></table></figure>
<h3 id="区间">区间</h3>
<h4 id="递归-4">递归</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Cache</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">from</span> sys <span class="hljs-keyword">import</span> setrecursionlimit<br>        <span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> lru_cache<br><br>        setrecursionlimit(<span class="hljs-built_in">int</span>(<span class="hljs-number">1e6</span>))<br><br>        self.lru_cache = lru_cache<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.lru_cache(maxsize=<span class="hljs-literal">None</span>)     <span class="hljs-comment"># return key is function</span><br><br><br>cache = Cache()<br>stone_sum = [<span class="hljs-number">0</span>]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">query_sum</span>(<span class="hljs-params">l, r</span>):<br>    <span class="hljs-keyword">return</span> stone_sum[r] - stone_sum[l - <span class="hljs-number">1</span>]<br><br><br><span class="hljs-meta">@cache.func()</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">min_stone</span>(<span class="hljs-params">l, r</span>):<br>    <span class="hljs-keyword">if</span> l == r:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><br>    m = <span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;inf&#x27;</span>)<br>    <span class="hljs-keyword">for</span> mid <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(l, r):<br>        left_cost = min_stone(l, mid) + query_sum(l, mid)<br>        right_cost = min_stone(mid + <span class="hljs-number">1</span>, r) + query_sum(mid + <span class="hljs-number">1</span>, r)<br><br>        m = <span class="hljs-built_in">min</span>(m, left_cost + right_cost)<br>    <span class="hljs-keyword">return</span> m<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br><br>    <span class="hljs-keyword">for</span> stone <span class="hljs-keyword">in</span> <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split()):<br>        stone_sum.append(stone_sum[-<span class="hljs-number">1</span>] + stone)<br><br>    <span class="hljs-built_in">print</span>(min_stone(<span class="hljs-number">1</span>, n))<br></code></pre></td></tr></table></figure>
<h4 id="dp-6">dp</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python">stone_sum = [<span class="hljs-number">0</span>]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">query_sum</span>(<span class="hljs-params">l, r</span>):<br>    <span class="hljs-keyword">return</span> stone_sum[r] - stone_sum[l - <span class="hljs-number">1</span>]<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br><br>    <span class="hljs-keyword">for</span> stone <span class="hljs-keyword">in</span> <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split()):<br>        stone_sum.append(stone_sum[-<span class="hljs-number">1</span>] + stone)<br><br>    dp = [[<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]<br><br>    <span class="hljs-keyword">for</span> length <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, n + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n - length + <span class="hljs-number">2</span>):<br>            r = l + length - <span class="hljs-number">1</span><br>            m = <span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;inf&#x27;</span>)<br>            <br>            <span class="hljs-keyword">for</span> mid <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(l, r):<br>                left = dp[l][mid] + query_sum(l, mid)<br>                right = dp[mid + <span class="hljs-number">1</span>][r] + query_sum(mid + <span class="hljs-number">1</span>, r)<br>                <br>                m = <span class="hljs-built_in">min</span>(m, left + right)<br>            <br>            dp[l][r] = m<br>            <br>    <span class="hljs-built_in">print</span>(dp[<span class="hljs-number">1</span>][n])<br></code></pre></td></tr></table></figure>
<h3 id="树型">树型</h3>
<p>等价于记忆化搜索</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Cache</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, limit=<span class="hljs-built_in">int</span>(<span class="hljs-params"><span class="hljs-number">1e5</span></span>)</span>):<br>        <span class="hljs-keyword">from</span> sys <span class="hljs-keyword">import</span> setrecursionlimit<br>        <span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> lru_cache<br><br>        setrecursionlimit(limit)<br><br>        self.lru_cache = lru_cache<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.lru_cache()     <span class="hljs-comment"># return key is function</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    cache = Cache()<br><br>    n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>    g = [[] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>)]<br>    w = [<span class="hljs-number">0</span>] + [<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>()) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br>    root = <span class="hljs-built_in">set</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>))<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n - <span class="hljs-number">1</span>):<br>        s, f = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>        g[f].append(s)<br>        root.discard(s)<br>    root = root.pop()<br><br><span class="hljs-meta">    @cache.func()</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">attend</span>(<span class="hljs-params">k</span>):     <span class="hljs-comment"># k root(attend) max joy</span><br>        s = w[k]<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> g[k]:<br>            s += <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, absent(i))<br>        <span class="hljs-keyword">return</span> s<br>    <br>    dfs = <span class="hljs-keyword">lambda</span> k: <span class="hljs-built_in">max</span>(attend(k), absent(k))<br><br><span class="hljs-meta">    @cache.func()</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">absent</span>(<span class="hljs-params">k</span>):      <span class="hljs-comment"># k root(absent) max joy</span><br>        s = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> g[k]:<br>            s += <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, dfs(i))<br>        <span class="hljs-keyword">return</span> s<br><br>    <span class="hljs-built_in">print</span>(dfs(root))<br></code></pre></td></tr></table></figure>
<h3 id="状态压缩">状态压缩</h3>
<h4 id="集合">集合</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python">n, m, k = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>N = <span class="hljs-number">1</span> &lt;&lt; m<br>bags = [<span class="hljs-number">0</span>] * n<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>    it = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> it:<br>        bags[i] |= <span class="hljs-number">1</span> &lt;&lt; j - <span class="hljs-number">1</span><br>dp = [<span class="hljs-number">101</span>] * N<br>dp[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> st <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N):<br>    <span class="hljs-keyword">for</span> bag <span class="hljs-keyword">in</span> bags:<br>        dp[st | bag] = <span class="hljs-built_in">min</span>(dp[st | bag], dp[st] + <span class="hljs-number">1</span>)<br><span class="hljs-keyword">if</span> dp[N - <span class="hljs-number">1</span>] &gt; <span class="hljs-number">100</span>:<br>    <span class="hljs-built_in">print</span>(-<span class="hljs-number">1</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(dp[N - <span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure>
<h4 id="棋盘">棋盘</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    n, m = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> n <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> m:<br>        <span class="hljs-keyword">break</span><br>    ST = <span class="hljs-number">1</span> &lt;&lt; n<br>    law = [<span class="hljs-literal">True</span>] * ST<br>    <span class="hljs-keyword">for</span> st <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(ST):<br>        cnt = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            <span class="hljs-keyword">if</span> st &gt;&gt; k &amp; <span class="hljs-number">1</span>:<br>                <span class="hljs-keyword">if</span> cnt &amp; <span class="hljs-number">1</span>:<br>                    law[st] = <span class="hljs-literal">False</span><br>                    <span class="hljs-keyword">break</span><br>                cnt = <span class="hljs-number">0</span><br>            <span class="hljs-keyword">else</span>:<br>                cnt += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> cnt &amp; <span class="hljs-number">1</span>:<br>            law[st] = <span class="hljs-literal">False</span><br>    dp = [[<span class="hljs-number">0</span>] * ST <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m + <span class="hljs-number">1</span>)]<br>    dp[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, m + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> st <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(ST):<br>            <span class="hljs-keyword">for</span> last <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(ST):<br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (st &amp; last) <span class="hljs-keyword">and</span> law[st | last]:<br>                    dp[i][st] += dp[i - <span class="hljs-number">1</span>][last]<br>    <span class="hljs-built_in">print</span>(dp[m][<span class="hljs-number">0</span>])<br></code></pre></td></tr></table></figure>
<h3 id="数位">数位</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python">N = <span class="hljs-number">10</span><br>f = [[<span class="hljs-number">1</span>] * N] + [[<span class="hljs-number">0</span>] * N <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N - <span class="hljs-number">1</span>)]<br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, N):<br>    <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n, N):<br>            f[k][n] += f[k - <span class="hljs-number">1</span>][i]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">count</span>(<span class="hljs-params">n</span>):   <span class="hljs-comment"># n &gt;= 0, [0, n]</span><br>    nums = [<span class="hljs-number">0</span>] + [<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>(n)]<br>    size = <span class="hljs-built_in">len</span>(nums) - <span class="hljs-number">1</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">k</span>):<br>        <span class="hljs-keyword">if</span> k &lt; <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>        p = size - k<br>        <span class="hljs-keyword">if</span> nums[p - <span class="hljs-number">1</span>] &gt; nums[p]:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>        cnt = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(nums[p - <span class="hljs-number">1</span>], nums[p]):<br>            cnt += f[k][i]<br>        <span class="hljs-keyword">return</span> cnt + dfs(k - <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> dfs(size - <span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">try</span>:<br>        l, r = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())<br>        <span class="hljs-built_in">print</span>(count(r) - count(l - <span class="hljs-number">1</span>))<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure>
<h2 id="贪心算法">贪心算法</h2>
<h3 id="绝对值不等式">绝对值不等式</h3>
<p class="katex-block "><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></munderover><mrow><mi>x</mi><mo>−</mo><msub><mi>a</mi><mi>i</mi></msub></mrow></mrow><annotation encoding="application/x-tex">\sum_{i=0}^{n-1}{x-a_i}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0788em;vertical-align:-1.2777em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">abs_min</span>(<span class="hljs-params">a</span>):<br>    n = <span class="hljs-built_in">len</span>(a)<br>    b = <span class="hljs-built_in">sorted</span>(a)<br>    l, r = <span class="hljs-number">0</span>, n - <span class="hljs-number">1</span><br>    s = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> l &lt; r:<br>        s += b[r] - b[l]<br>        l += <span class="hljs-number">1</span><br>        r -= <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> s<br></code></pre></td></tr></table></figure>
<h4 id="糖果传递">糖果传递</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>a = [<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>()) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)]<br>av = <span class="hljs-built_in">sum</span>(a) // n<br>b = [<span class="hljs-number">0</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n):<br>    b.append(b[i - <span class="hljs-number">1</span>] + av - a[i])<br><span class="hljs-built_in">print</span>(abs_max(n, b))<br></code></pre></td></tr></table></figure>
<h3 id="区间选点">区间选点</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">n = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br>intervals = <span class="hljs-built_in">sorted</span>([<span class="hljs-built_in">tuple</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n)], key = <span class="hljs-keyword">lambda</span> t: t[<span class="hljs-number">1</span>])<br>r, cnt = intervals[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], <span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n):<br>    l = intervals[i][<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">if</span> l &gt; r:<br>        r = intervals[i][<span class="hljs-number">1</span>]<br>        cnt += <span class="hljs-number">1</span><br><span class="hljs-built_in">print</span>(cnt)<br></code></pre></td></tr></table></figure>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E7%BC%96%E7%A8%8B/" class="print-no-link">#编程</a>
      
    </div>
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/07/23/%E5%A4%8D%E6%9D%82%E5%BA%A6%E4%B8%8E%E7%BA%BF%E6%80%A7%E8%A1%A8/" title="复杂度与线性表">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">复杂度与线性表</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  








    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <div></div> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
        let ddl = $("#ddl")
        let mw = $("#mw")

        let dasai = new Date("2023-12-23");
        let today = new Date();

        let days = parseInt((dasai - today) / 1000 / 60 / 60 / 24);
        let months = parseInt(days / 30);
        let weeks = parseInt(days / 7);

        var lgw_title = `距离 12-23 ${days} 天 ≈ ${months} 个月 ≈ ${weeks} 周`
  </script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        if (text == 'nanana') 
          text = lgw_title;
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
